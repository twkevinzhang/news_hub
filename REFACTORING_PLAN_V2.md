# News Hub é‡æ§‹è¨ˆç•« v2.0 ğŸ“‹

**å»ºç«‹æ—¥æœŸ**: 2026-01-14
**æ›´æ–°æ—¥æœŸ**: 2026-01-14
**åˆ†æç¯„åœ**: Dart ç¨‹å¼ç¢¼æ¶æ§‹ã€DDD è¦ç¯„ã€BLoC æ•ˆèƒ½å„ªåŒ–
**åŸºæº–æ–‡ä»¶**: CLAUDE.md - æ¶æ§‹è¨­è¨ˆè¦ç¯„ã€æ•ˆèƒ½èˆ‡å“è³ªè¦æ±‚
**æ–‡ä»¶æ€§è³ª**: Spec-Driven Development - é©ç”¨æ–¼ AI Agent åŸ·è¡Œ

---

## ğŸ“– é–±è®€æŒ‡å—

### æ–‡ä»¶çµæ§‹

æœ¬è¨ˆç•«æ¡ç”¨ **Spec-Driven Development** æ–¹æ³•è«–ï¼Œæ¯å€‹ä»»å‹™åŒ…å«ï¼š

1. **å•é¡Œæè¿°** - ç•¶å‰å•é¡Œå’Œå½±éŸ¿ç¯„åœ
2. **è§£æ±ºæ–¹æ¡ˆ** - å…·é«”çš„é‡æ§‹æ–¹æ¡ˆï¼ˆå« Before/After ç¨‹å¼ç¢¼ï¼‰
3. **åŸ·è¡Œæ­¥é©Ÿ** - é€æ­¥é©Ÿçš„æ“ä½œæŒ‡ä»¤
4. **é©—æ”¶æ¨™æº–** - æ˜ç¢ºçš„å®Œæˆæª¢æŸ¥æ¸…å–®
5. **é©—è­‰æ–¹æ³•** - å¦‚ä½•é©—è­‰é‡æ§‹æˆåŠŸ

### ç¬¦è™Ÿèªªæ˜

- ğŸ”´ **æœ€é«˜å„ªå…ˆç´š** - å¿…é ˆç«‹å³åŸ·è¡Œ
- ğŸŸ¡ **é«˜å„ªå…ˆç´š** - é‡è¦ä½†å¯ç¨å¾ŒåŸ·è¡Œ
- ğŸŸ¢ **ä¸­/ä½å„ªå…ˆç´š** - å¯ä¾æ“šè³‡æºç‹€æ³åŸ·è¡Œ
- â­ **è¤‡é›œä»»å‹™** - éœ€è¦é¡å¤–æ³¨æ„å’Œæ¸¬è©¦
- âœ… **é©—æ”¶é …ç›®** - å¿…é ˆé€šéçš„æª¢æŸ¥é»

---

## ğŸ“Š åŸ·è¡Œæ‘˜è¦

ç¶“éæ·±å…¥ç¨‹å¼ç¢¼å¯©æŸ¥ï¼Œç™¼ç¾ News Hub å°ˆæ¡ˆå­˜åœ¨ä»¥ä¸‹ä¸»è¦å•é¡Œï¼š

### ğŸ”´ åš´é‡å•é¡Œ

1. **Domain å±¤ä¾è³´é•è¦** (9 é …)
2. **BLoC æ•´é é‡å»ºå•é¡Œ** (8 å€‹é é¢)
3. **æ¸¬è©¦è¦†è“‹ç‡åš´é‡ä¸è¶³** (Domain å±¤ 0%)

### ğŸŸ¡ é‡è¦å•é¡Œ

4. **Use Case é•åå–®ä¸€è·è²¬** (3 å€‹ Use Case)
5. **State ç²’åº¦è¨­è¨ˆéç²—** (2 å€‹ State)
6. **ç¼ºå°‘ const constructor å„ªåŒ–**

### è©•åˆ†

- **æ¶æ§‹åˆè¦æ€§**: 45/100 âŒ
- **æ•ˆèƒ½å„ªåŒ–**: 30/100 âŒ
- **æ¸¬è©¦è¦†è“‹ç‡**: 5/100 âŒ
- **æ•´é«”è©•ä¼°**: **ä¸ç¬¦åˆ CLAUDE.md è¦ç¯„ï¼Œéœ€è¦å¤§è¦æ¨¡é‡æ§‹**

---

## ğŸ¯ é‡æ§‹ç›®æ¨™

### çŸ­æœŸç›®æ¨™ (1-2 é€±)

- [ ] ä¿®å¾©æ‰€æœ‰ Domain å±¤ä¾è³´é•è¦
- [ ] å„ªåŒ– 3 å€‹é—œéµé é¢çš„ BLoC é‡å»º (HomeScreen, ThreadDetailScreen, SidecarLogsScreen)
- [ ] å»ºç«‹ Domain å±¤æ¸¬è©¦æ¡†æ¶ï¼Œè¦†è“‹ç‡é” 50%+

### ä¸­æœŸç›®æ¨™ (3-4 é€±)

- [ ] é‡æ§‹è¤‡é›œ Use Caseï¼Œç¬¦åˆå–®ä¸€è·è²¬åŸå‰‡
- [ ] å„ªåŒ–æ‰€æœ‰é é¢çš„ BLoC é‡å»ºï¼Œé”æˆ 80%+ æ¸›å°‘ç‡
- [ ] Domain å±¤æ¸¬è©¦è¦†è“‹ç‡é” 80%+

### é•·æœŸç›®æ¨™ (1-2 å€‹æœˆ)

- [ ] å®Œæ•´ Entity/Value Object freezed åŒ–
- [ ] Presentation å±¤é—œéµåŠŸèƒ½æ¸¬è©¦è¦†è“‹ç‡é” 60%+
- [ ] éœæ…‹åˆ†æ 0 warning (ç›®å‰ 57 issues)

---

## ğŸ“‘ é‡æ§‹ä»»å‹™æ¸…å–®

### Phase 1: æ¶æ§‹åˆè¦æ€§ä¿®å¾© (Critical) ğŸ”¥

---

#### Task 1.1: é‡å‘½å ExtensionPreferencesService ç‚ºæ¥­å‹™å°å‘åç¨±

**å„ªå…ˆç´š**: ğŸ”´ æœ€é«˜
**é ä¼°å·¥æ™‚**: 1.5 å°æ™‚
**å—å½±éŸ¿æª”æ¡ˆ**: 3-5 å€‹

##### å•é¡Œæè¿°

**ç•¶å‰ç‹€æ³**:

```
æª”æ¡ˆ: lib/domain/extension/services/extension_preferences_service.dart
```

**å•é¡Œ**:

1. æª”æ¡ˆåç¨±åŒ…å«æŠ€è¡“è¡“èª "Preferences"ï¼ˆé€™æ˜¯åŸºç¤è¨­æ–½å±¤çš„æ¦‚å¿µï¼‰
2. é•å DDD åŸå‰‡ï¼šDomain å±¤æ‡‰ä½¿ç”¨æ¥­å‹™èªè¨€ï¼ˆUbiquitous Languageï¼‰
3. ä¾è³´äº† `app/service/preferences/preference.dart`ï¼Œé•åä¾è³´å€’ç½®åŸå‰‡

**å½±éŸ¿**:

- é•å CLAUDE.md çš„ Domain å±¤ä¾è³´é™åˆ¶
- Domain å±¤ä¸æ‡‰è©²çŸ¥é“ "Preferences" é€™ç¨®æŠ€è¡“å¯¦ç¾ç´°ç¯€

##### è§£æ±ºæ–¹æ¡ˆ

**æ–¹æ¡ˆé¸æ“‡**: é‡å‘½åç‚º `ExtensionSettings`

**ç†ç”±**:

- "Settings" æ˜¯æ¥­å‹™æ¦‚å¿µï¼Œè¡¨é”ã€Œä½¿ç”¨è€…å°æ“´å±•çš„è¨­å®šã€
- ä¸æ¶‰åŠæŠ€è¡“å¯¦ç¾ç´°ç¯€
- ç¬¦åˆ Ubiquitous Language åŸå‰‡

##### Before (ç•¶å‰ç‹€æ…‹)

```dart
// lib/domain/extension/services/extension_preferences_service.dart
import 'package:news_hub/app/service/preferences/preference.dart';  // âŒ ä¾è³´ app å±¤

abstract class ExtensionPreferencesService {
  // ...
}
```

##### After (é‡æ§‹å¾Œ)

```dart
// lib/domain/extension/services/extension_settings.dart
// ä¸å†ä¾è³´ app å±¤

abstract class ExtensionSettings {
  /// å„²å­˜æ“´å±•çš„å•Ÿç”¨ç‹€æ…‹
  Future<void> saveEnabledState(String extensionId, bool isEnabled);

  /// æª¢æŸ¥æ“´å±•æ˜¯å¦å·²å•Ÿç”¨
  Future<bool> isEnabled(String extensionId);

  /// ç›£è½å·²å•Ÿç”¨çš„æ“´å±•é›†åˆ
  Stream<Set<String>> watchEnabledExtensions();
}
```

##### åŸ·è¡Œæ­¥é©Ÿ

**æ­¥é©Ÿ 1.1.1**: å‰µå»ºæ–°æª”æ¡ˆä¸¦å®šç¾©ä»‹é¢ (15 åˆ†é˜)

1. åœ¨ VSCode ä¸­é–‹å•Ÿå°ˆæ¡ˆæ ¹ç›®éŒ„
2. å‰µå»ºæ–°æª”æ¡ˆï¼š`lib/domain/extension/services/extension_settings.dart`
3. è¤‡è£½ä»¥ä¸‹ç¨‹å¼ç¢¼åˆ°æ–°æª”æ¡ˆï¼š

```dart
/// Extension Settings Service
///
/// ç®¡ç†ä½¿ç”¨è€…å°æ“´å±•çš„è¨­å®šï¼ŒåŒ…æ‹¬å•Ÿç”¨/åœç”¨ç‹€æ…‹ã€ä½¿ç”¨è€…åå¥½ç­‰ã€‚
///
/// é€™æ˜¯ Domain å±¤çš„æœå‹™ä»‹é¢ï¼Œä¸åŒ…å«ä»»ä½•æŠ€è¡“å¯¦ç¾ç´°ç¯€ã€‚
/// å…·é«”å¯¦ç¾ç”± App å±¤çš„ ExtensionSettingsImpl æä¾›ã€‚
abstract class ExtensionSettings {
  /// å„²å­˜æŒ‡å®šæ“´å±•çš„å•Ÿç”¨ç‹€æ…‹
  ///
  /// [extensionId] æ“´å±•çš„å”¯ä¸€è­˜åˆ¥ç¢¼ï¼ˆpkg_nameï¼‰
  /// [isEnabled] true è¡¨ç¤ºå•Ÿç”¨ï¼Œfalse è¡¨ç¤ºåœç”¨
  Future<void> saveEnabledState(String extensionId, bool isEnabled);

  /// æª¢æŸ¥æŒ‡å®šæ“´å±•æ˜¯å¦å·²å•Ÿç”¨
  ///
  /// [extensionId] æ“´å±•çš„å”¯ä¸€è­˜åˆ¥ç¢¼ï¼ˆpkg_nameï¼‰
  ///
  /// Returns: true è¡¨ç¤ºå·²å•Ÿç”¨ï¼Œfalse è¡¨ç¤ºæœªå•Ÿç”¨æˆ–ä¸å­˜åœ¨
  Future<bool> isEnabled(String extensionId);

  /// ç›£è½å·²å•Ÿç”¨çš„æ“´å±•é›†åˆè®ŠåŒ–
  ///
  /// Returns: Streamï¼Œæ¯æ¬¡å•Ÿç”¨ç‹€æ…‹è®ŠåŒ–æ™‚ç™¼å‡ºæ–°çš„æ“´å±• ID é›†åˆ
  Stream<Set<String>> watchEnabledExtensions();
}
```

4. å„²å­˜æª”æ¡ˆ
5. é©—è­‰èªæ³•ï¼šé‹è¡Œ `dart analyze lib/domain/extension/services/extension_settings.dart`

**é æœŸè¼¸å‡º**: ç„¡éŒ¯èª¤ã€ç„¡è­¦å‘Š

---

**æ­¥é©Ÿ 1.1.2**: æ›´æ–° App å±¤å¯¦ç¾ (30 åˆ†é˜)

1. æ‰¾åˆ°åŸæœ¬çš„å¯¦ç¾æª”æ¡ˆï¼ˆé€šå¸¸åœ¨ `lib/app/extension/` ç›®éŒ„ä¸‹ï¼‰
2. å°‡å¯¦ç¾é¡åˆ¥é‡å‘½åï¼š

```dart
// Before
class ExtensionPreferencesServiceImpl implements ExtensionPreferencesService {
  // ...
}

// After
class ExtensionSettingsImpl implements ExtensionSettings {
  // å¯¦ç¾ä¿æŒä¸è®Šï¼Œåªæ˜¯ä»‹é¢åç¨±æ”¹è®Š
}
```

3. æ›´æ–° import èªå¥ï¼š

```dart
// Before
import 'package:news_hub/domain/extension/services/extension_preferences_service.dart';

// After
import 'package:news_hub/domain/extension/services/extension_settings.dart';
```

4. å„²å­˜æª”æ¡ˆ

---

**æ­¥é©Ÿ 1.1.3**: æ›´æ–°æ‰€æœ‰ä½¿ç”¨è™• (30 åˆ†é˜)

1. ä½¿ç”¨ VSCode å…¨åŸŸæœå°‹ï¼š`ExtensionPreferencesService`
2. å°æ¯å€‹æœå°‹çµæœï¼š
   - å°‡é¡å‹åç¨±æ”¹ç‚º `ExtensionSettings`
   - æ›´æ–° import è·¯å¾‘
   - æ›´æ–°è®Šæ•¸åç¨±ï¼ˆå¯é¸ï¼Œä½†å»ºè­°åŒæ­¥æ›´æ–°ï¼‰

ç¤ºä¾‹ï¼š

```dart
// Before
final ExtensionPreferencesService _preferencesService;

// After
final ExtensionSettings _settings;
```

3. ä½¿ç”¨ VSCode å…¨åŸŸæœå°‹ï¼š`extension_preferences_service`ï¼ˆæª”æ¡ˆè·¯å¾‘ï¼‰
4. æ›´æ–°æ‰€æœ‰ import èªå¥

---

**æ­¥é©Ÿ 1.1.4**: åˆªé™¤èˆŠæª”æ¡ˆä¸¦æ›´æ–° DI é…ç½® (15 åˆ†é˜)

1. åˆªé™¤èˆŠæª”æ¡ˆï¼š`lib/domain/extension/services/extension_preferences_service.dart`
2. å¦‚æœæœ‰è‡ªå‹•ç”Ÿæˆçš„æª”æ¡ˆï¼ˆå¦‚ `.g.dart`, `.freezed.dart`ï¼‰ï¼Œä¸€ä½µåˆªé™¤
3. æ›´æ–° `lib/locator.dart` æˆ– DI é…ç½®ï¼š

```dart
// Before (å¦‚æœæœ‰æ˜ç¢ºè¨»å†Š)
@Injectable(as: ExtensionPreferencesService)
class ExtensionPreferencesServiceImpl implements ExtensionPreferencesService { }

// After
@Injectable(as: ExtensionSettings)
class ExtensionSettingsImpl implements ExtensionSettings { }
```

4. é‹è¡Œ `dart run build_runner build --delete-conflicting-outputs`

---

**æ­¥é©Ÿ 1.1.5**: é‹è¡Œæ¸¬è©¦å’Œé©—è­‰ (15 åˆ†é˜)

1. ç·¨è­¯æª¢æŸ¥ï¼š

   ```bash
   flutter analyze
   ```

2. å¦‚æœæœ‰ç›¸é—œæ¸¬è©¦ï¼Œé‹è¡Œæ¸¬è©¦ï¼š

   ```bash
   flutter test test/domain/extension/
   ```

3. æ‰‹å‹•æ¸¬è©¦ï¼ˆå¦‚æœæ²’æœ‰è‡ªå‹•åŒ–æ¸¬è©¦ï¼‰ï¼š
   - å•Ÿå‹•æ‡‰ç”¨
   - å°èˆªè‡³æ“´å±•ç®¡ç†é é¢
   - å•Ÿç”¨/åœç”¨ä¸€å€‹æ“´å±•
   - é©—è­‰è¨­å®šè¢«æ­£ç¢ºå„²å­˜
   - é‡å•Ÿæ‡‰ç”¨ï¼Œé©—è­‰è¨­å®šè¢«æ­£ç¢ºè¼‰å…¥

##### é©—æ”¶æ¨™æº–

**å¿…é ˆå…¨éƒ¨é€šé** âœ…ï¼š

- [ ] âœ… æ–°æª”æ¡ˆ `extension_settings.dart` å·²å‰µå»ºï¼ŒåŒ…å«å®Œæ•´ä»‹é¢å®šç¾©
- [ ] âœ… èˆŠæª”æ¡ˆ `extension_preferences_service.dart` å·²åˆªé™¤
- [ ] âœ… æ‰€æœ‰ import èªå¥å·²æ›´æ–°ç‚ºæ–°è·¯å¾‘
- [ ] âœ… App å±¤å¯¦ç¾é¡åˆ¥å·²æ›´æ–°ç‚º `ExtensionSettingsImpl`
- [ ] âœ… DI é…ç½®å·²æ›´æ–°ï¼ˆå¦‚é©ç”¨ï¼‰
- [ ] âœ… `flutter analyze` é›¶éŒ¯èª¤ã€é›¶æ–°å¢è­¦å‘Š
- [ ] âœ… æ‰€æœ‰ç¾æœ‰æ¸¬è©¦é€šéï¼ˆå¦‚æœ‰ï¼‰
- [ ] âœ… æ‰‹å‹•åŠŸèƒ½æ¸¬è©¦é€šéï¼šå•Ÿç”¨/åœç”¨æ“´å±•åŠŸèƒ½æ­£å¸¸

**ç¦æ­¢å‡ºç¾** âŒï¼š

- [ ] âŒ Domain å±¤ä»æœ‰ä»»ä½•å° `app/service/preferences` çš„ import
- [ ] âŒ ä»»ä½•æª”æ¡ˆä»åŒ…å« `ExtensionPreferencesService` å‘½å
- [ ] âŒ ç·¨è­¯éŒ¯èª¤æˆ–æ–°çš„è­¦å‘Š

##### é©—è­‰æ–¹æ³•

**è‡ªå‹•åŒ–é©—è­‰**:

```bash
# 1. æª¢æŸ¥æ–°æª”æ¡ˆå­˜åœ¨
test -f lib/domain/extension/services/extension_settings.dart && echo "âœ… æ–°æª”æ¡ˆå­˜åœ¨" || echo "âŒ æ–°æª”æ¡ˆä¸å­˜åœ¨"

# 2. æª¢æŸ¥èˆŠæª”æ¡ˆå·²åˆªé™¤
test ! -f lib/domain/extension/services/extension_preferences_service.dart && echo "âœ… èˆŠæª”æ¡ˆå·²åˆªé™¤" || echo "âŒ èˆŠæª”æ¡ˆä»å­˜åœ¨"

# 3. æª¢æŸ¥æ²’æœ‰æ®˜ç•™çš„èˆŠå‘½å
! grep -r "ExtensionPreferencesService" lib/domain --include="*.dart" && echo "âœ… ç„¡èˆŠå‘½åæ®˜ç•™" || echo "âŒ ä»æœ‰èˆŠå‘½å"

# 4. æª¢æŸ¥æ²’æœ‰å° app å±¤çš„ä¾è³´
! grep -r "app/service/preferences" lib/domain --include="*.dart" && echo "âœ… ç„¡ app å±¤ä¾è³´" || echo "âŒ ä»æœ‰ app å±¤ä¾è³´"

# 5. éœæ…‹åˆ†æ
flutter analyze
```

**æ‰‹å‹•é©—è­‰**:

1. åœ¨ VSCode ä¸­é–‹å•Ÿ `lib/domain/extension/services/extension_settings.dart`
2. ç¢ºèªæª”æ¡ˆå…§å®¹ç¬¦åˆ After ç¯„ä¾‹
3. ä½¿ç”¨ VSCode çš„ "Find All References" åŠŸèƒ½æª¢æŸ¥æ‰€æœ‰å¼•ç”¨
4. ç¢ºèªæ‰€æœ‰å¼•ç”¨éƒ½ä½¿ç”¨æ–°åç¨± `ExtensionSettings`

##### æ³¨æ„äº‹é …

âš ï¸ **é‡è¦**:

- é€™æ˜¯**é‡å‘½å + é‡æ–°è¨­è¨ˆä»‹é¢**ï¼Œä¸åªæ˜¯æª”æ¡ˆé‡å‘½å
- å¦‚æœåŸæœ¬çš„ `ExtensionPreferencesService` æœ‰ä¾è³´ `Preference<T>` é¡å‹ï¼Œéœ€è¦åœ¨ Task 1.2 ä¸­è™•ç†
- ç¢ºä¿æ‰€æœ‰ git commit éƒ½åŒ…å«æœ‰æ„ç¾©çš„è¨Šæ¯

ğŸ“ **å»ºè­°çš„ Commit Message**:

```
refactor(domain): rename ExtensionPreferencesService to ExtensionSettings

- Remove technical term "Preferences" from Domain layer
- Use business-oriented term "Settings" instead
- Eliminate dependency on app/service/preferences
- Align with DDD Ubiquitous Language principle

BREAKING CHANGE: ExtensionPreferencesService renamed to ExtensionSettings
All consumers must update their imports and type references.

Ref: REFACTORING_PLAN.md Task 1.1
```

---

#### Task 1.2: æ‹†åˆ† models.dart ç‚ºç¨ç«‹æª”æ¡ˆ

**å„ªå…ˆç´š**: ğŸŸ¡ é«˜
**é ä¼°å·¥æ™‚**: 6-8 å°æ™‚
**å—å½±éŸ¿æª”æ¡ˆ**: 1 å€‹ä¸»æª”æ¡ˆ â†’ 40+ å€‹ç¨ç«‹æª”æ¡ˆ

##### å•é¡Œæè¿°

**ç•¶å‰ç‹€æ³**:

```
æª”æ¡ˆ: lib/domain/models/models.dart (ä¼°è¨ˆ 500+ è¡Œ)
```

**å•é¡Œ**:

1. **VSCode IDE æ”¯æ´ä¸ä½³**: "Go to Definition" è·³è½‰åˆ°å–®ä¸€å¤§æª”æ¡ˆï¼Œéœ€è¦æ‰‹å‹•æœå°‹
2. **å–®ä¸€æª”æ¡ˆéæ–¼è¤‡é›œ**: åŒ…å« 40+ å€‹é¡åˆ¥å®šç¾©
3. **Code Review å›°é›£**: ç„¡æ³•ç²¾ç¢ºè¨è«–å–®ä¸€ Entity çš„è®Šæ›´
4. **Git Merge Conflict**: å¤šäººåŒæ™‚ä¿®æ”¹å®¹æ˜“è¡çª
5. **é•å SRP**: ä¸€å€‹æª”æ¡ˆåŒ…å«éå¤šè·è²¬

**å½±éŸ¿**:

- é–‹ç™¼æ•ˆç‡é™ä½ï¼ˆç‰¹åˆ¥æ˜¯ VSCode ç”¨æˆ¶ï¼‰
- å¯ç¶­è­·æ€§å·®
- åœ˜éšŠå”ä½œå›°é›£

##### è§£æ±ºæ–¹æ¡ˆ

**æ–¹æ¡ˆ**: å°‡ `models.dart` æ‹†åˆ†ç‚ºç¨ç«‹æª”æ¡ˆï¼ŒæŒ‰ Bounded Context çµ„ç¹”

**è¨­è¨ˆåŸå‰‡**:

- æ¯å€‹ Entity ä¸€å€‹æª”æ¡ˆ
- æŒ‰æ¥­å‹™é ˜åŸŸåˆ†çµ„ï¼ˆcollection, thread, extension ç­‰ï¼‰
- ä¿ç•™ `models.dart` ä½œç‚º Barrel Fileï¼ˆçµ±ä¸€ exportï¼‰
- ä½¿ç”¨è€…ä»å¯ç”¨ `import 'package:news_hub/domain/models/models.dart';` ä¸€æ¬¡å°å…¥æ‰€æœ‰ models

##### Before (ç•¶å‰çµæ§‹)

```
lib/domain/models/
â””â”€â”€ models.dart  (500+ è¡Œï¼ŒåŒ…å«æ‰€æœ‰ Entity)
```

##### After (é‡æ§‹å¾Œçµæ§‹)

```
lib/domain/models/
â”œâ”€â”€ models.dart                          # Barrel file (çµ±ä¸€ exportï¼Œ100 è¡Œ)
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ pagination.dart                  # Pagination Entity
â”‚   â”œâ”€â”€ result.dart                      # Result<T> Entity
â”‚   â””â”€â”€ health_check_result.dart         # HealthCheckResult Entity
â”œâ”€â”€ sidecar/
â”‚   â””â”€â”€ log_entry.dart                   # LogEntry Entity
â”œâ”€â”€ repo/
â”‚   â””â”€â”€ repo.dart                        # Repo Entity
â”œâ”€â”€ extension/
â”‚   â”œâ”€â”€ extension.dart                   # Extension Entity
â”‚   â”œâ”€â”€ remote_extension.dart            # RemoteExtension Entity
â”‚   â””â”€â”€ extension_with_boards.dart       # ExtensionWithBoards (å¾ Use Case ç§»éä¾†)
â”œâ”€â”€ collection/
â”‚   â”œâ”€â”€ collection.dart                  # Collection Entity
â”‚   â”œâ”€â”€ collection_board.dart            # CollectionBoard Entity
â”‚   â””â”€â”€ board_identity.dart              # BoardIdentity Value Object
â”œâ”€â”€ thread/
â”‚   â”œâ”€â”€ post/
â”‚   â”‚   â”œâ”€â”€ post.dart                    # Post base class
â”‚   â”‚   â”œâ”€â”€ single_image_post.dart       # SingleImagePost Entity
â”‚   â”‚   â”œâ”€â”€ article_post.dart            # ArticlePost Entity
â”‚   â”‚   â””â”€â”€ single_image_post_with_extension.dart  # (å¾ Use Case ç§»éä¾†)
â”‚   â”œâ”€â”€ paragraph/
â”‚   â”‚   â”œâ”€â”€ paragraph.dart               # Paragraph base class
â”‚   â”‚   â”œâ”€â”€ text_paragraph.dart          # TextParagraph
â”‚   â”‚   â”œâ”€â”€ image_paragraph.dart         # ImageParagraph
â”‚   â”‚   â”œâ”€â”€ video_paragraph.dart         # VideoParagraph
â”‚   â”‚   â””â”€â”€ youtube_paragraph.dart       # YouTubeParagraph
â”‚   â”œâ”€â”€ comment.dart                     # Comment Entity
â”‚   â””â”€â”€ board_data_chunk.dart            # BoardDataChunk (å¾ Use Case ç§»éä¾†)
â”œâ”€â”€ board/
â”‚   â””â”€â”€ board.dart                       # Board Entity
â”œâ”€â”€ bookmark/
â”‚   â””â”€â”€ bookmark.dart                    # Bookmark Entity
â””â”€â”€ suggestion/
    â””â”€â”€ suggestion.dart                  # Suggestion Entity
```

##### åŸ·è¡Œæ­¥é©Ÿ

**æ­¥é©Ÿ 1.2.1**: å‰µå»ºç›®éŒ„çµæ§‹ (10 åˆ†é˜)

åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„åŸ·è¡Œ
cd /Users/zhangzhenlong/Projects/news_hub

# å‰µå»ºç›®éŒ„çµæ§‹
mkdir -p lib/domain/models/common
mkdir -p lib/domain/models/sidecar
mkdir -p lib/domain/models/repo
mkdir -p lib/domain/models/extension
mkdir -p lib/domain/models/collection
mkdir -p lib/domain/models/thread/post
mkdir -p lib/domain/models/thread/paragraph
mkdir -p lib/domain/models/board
mkdir -p lib/domain/models/bookmark
mkdir -p lib/domain/models/suggestion

# é©—è­‰ç›®éŒ„å‰µå»ºæˆåŠŸ
ls -la lib/domain/models/
```

**é æœŸè¼¸å‡º**: é¡¯ç¤ºæ‰€æœ‰æ–°å‰µå»ºçš„ç›®éŒ„

---

**æ­¥é©Ÿ 1.2.2**: æå– Entity åˆ°ç¨ç«‹æª”æ¡ˆ (3-4 å°æ™‚)

**é‡è¦**: æŒ‰ä»¥ä¸‹é †åºåŸ·è¡Œï¼Œå¾ç°¡å–®åˆ°è¤‡é›œ

**2.2.1 - æå– Common ç›¸é—œ Entity** (30 åˆ†é˜)

1. å‰µå»º `lib/domain/models/common/pagination.dart`:

```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'pagination.freezed.dart';
part 'pagination.g.dart';

@freezed
class Pagination with _$Pagination {
  const factory Pagination({
    required int page,
    required int pageSize,
  }) = _Pagination;

  factory Pagination.fromJson(Map<String, dynamic> json) =>
      _$PaginationFromJson(json);
}
```

2. å‰µå»º `lib/domain/models/common/result.dart`:

```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'result.freezed.dart';

@freezed
class Result<T> with _$Result<T> {
  const factory Result.success(T data) = Success<T>;
  const factory Result.error(String message) = Error<T>;
  const factory Result.loading() = Loading<T>;
}
```

3. å‰µå»º `lib/domain/models/common/health_check_result.dart`:

```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'health_check_result.freezed.dart';
part 'health_check_result.g.dart';

@freezed
class HealthCheckResult with _$HealthCheckResult {
  const factory HealthCheckResult({
    required bool isHealthy,
    String? message,
  }) = _HealthCheckResult;

  factory HealthCheckResult.fromJson(Map<String, dynamic> json) =>
      _$HealthCheckResultFromJson(json);
}
```

**é©—è­‰**:

```bash
dart analyze lib/domain/models/common/
```

---

**2.2.2 - æå–å…¶ä»–ç°¡å–® Entity** (1 å°æ™‚)

æŒ‰ç…§ç›¸åŒæ¨¡å¼æå–ï¼š

- `lib/domain/models/sidecar/log_entry.dart`
- `lib/domain/models/repo/repo.dart`
- `lib/domain/models/bookmark/bookmark.dart`
- `lib/domain/models/suggestion/suggestion.dart`
- `lib/domain/models/board/board.dart`

**ç¯„ä¾‹**: `lib/domain/models/sidecar/log_entry.dart`:

```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'log_entry.freezed.dart';
part 'log_entry.g.dart';

enum LogLevel { debug, info, warning, error, critical }

@freezed
class LogEntry with _$LogEntry {
  const factory LogEntry({
    required DateTime timestamp,
    required LogLevel level,
    required String loggerName,
    required String message,
    String? exception,
  }) = _LogEntry;

  factory LogEntry.fromJson(Map<String, dynamic> json) =>
      _$LogEntryFromJson(json);
}
```

---

**2.2.3 - æå– Extension ç›¸é—œ Entity** (30 åˆ†é˜)

æå–ï¼š

- `lib/domain/models/extension/extension.dart`
- `lib/domain/models/extension/remote_extension.dart`
- `lib/domain/models/extension/extension_with_boards.dart` ï¼ˆå¾ Use Case ç§»éä¾†ï¼‰

**é‡è¦**: `RemoteExtension` ç¹¼æ‰¿è‡ª `Extension`ï¼Œéœ€è¦è™•ç†ç¹¼æ‰¿é—œä¿‚ï¼š

```dart
// lib/domain/models/extension/extension.dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'extension.freezed.dart';
part 'extension.g.dart';

@freezed
class Extension with _$Extension {
  const factory Extension({
    required String pkgName,
    required String displayName,
    required int version,
    required int pythonVersion,
    required bool isNsfw,
  }) = _Extension;

  factory Extension.fromJson(Map<String, dynamic> json) =>
      _$ExtensionFromJson(json);
}
```

```dart
// lib/domain/models/extension/remote_extension.dart
import 'package:freezed_annotation/freezed_annotation.dart';
import 'extension.dart';

part 'remote_extension.freezed.dart';
part 'remote_extension.g.dart';

@freezed
class RemoteExtension with _$RemoteExtension {
  const factory RemoteExtension({
    required String pkgName,
    required String displayName,
    required int version,
    required int pythonVersion,
    required bool isNsfw,
    required String repoUrl,
    required bool isDeprecated,
  }) = _RemoteExtension;

  factory RemoteExtension.fromJson(Map<String, dynamic> json) =>
      _$RemoteExtensionFromJson(json);

  // è½‰æ›ç‚º Extension
  Extension toExtension() {
    return Extension(
      pkgName: pkgName,
      displayName: displayName,
      version: version,
      pythonVersion: pythonVersion,
      isNsfw: isNsfw,
    );
  }
}
```

---

**2.2.4 - æå– Collection ç›¸é—œ Entity** (30 åˆ†é˜)

æå–ï¼š

- `lib/domain/models/collection/board_identity.dart` ï¼ˆValue Objectï¼‰
- `lib/domain/models/collection/collection_board.dart`
- `lib/domain/models/collection/collection.dart`

**æ³¨æ„é †åº**: å…ˆæå– `BoardIdentity`ï¼Œå› ç‚º `CollectionBoard` ä¾è³´å®ƒ

```dart
// lib/domain/models/collection/board_identity.dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'board_identity.freezed.dart';
part 'board_identity.g.dart';

@freezed
class BoardIdentity with _$BoardIdentity {
  const factory BoardIdentity({
    required String extensionPkgName,
    required String boardId,
    required String boardName,
  }) = _BoardIdentity;

  factory BoardIdentity.fromJson(Map<String, dynamic> json) =>
      _$BoardIdentityFromJson(json);
}
```

---

**2.2.5 - æå– Thread ç›¸é—œ Entity** (1.5-2 å°æ™‚) â­ **æœ€è¤‡é›œ**

é€™éƒ¨åˆ†æœ€è¤‡é›œï¼Œå› ç‚ºæœ‰ç¹¼æ‰¿é—œä¿‚å’Œå¤§é‡å­é¡åˆ¥ã€‚

**æå–é †åº**:

1. **Base classes å…ˆè¡Œ**:

   - `lib/domain/models/thread/paragraph/paragraph.dart` (base)
   - `lib/domain/models/thread/post/post.dart` (base)

2. **Paragraph å­é¡åˆ¥**:

   - `text_paragraph.dart`
   - `image_paragraph.dart`
   - `video_paragraph.dart`
   - `youtube_paragraph.dart`

3. **Post å­é¡åˆ¥**:

   - `single_image_post.dart`
   - `article_post.dart`
   - `single_image_post_with_extension.dart`

4. **å…¶ä»–**:
   - `comment.dart`
   - `board_data_chunk.dart`

**ç¯„ä¾‹**: `lib/domain/models/thread/paragraph/paragraph.dart`:

```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'paragraph.freezed.dart';
part 'paragraph.g.dart';

@Freezed(unionKey: 'type')
sealed class Paragraph with _$Paragraph {
  const factory Paragraph.text({
    required String content,
  }) = TextParagraph;

  const factory Paragraph.image({
    required String url,
    String? thumbnail,
    String? description,
  }) = ImageParagraph;

  const factory Paragraph.video({
    required String url,
    String? thumbnail,
    String? title,
  }) = VideoParagraph;

  const factory Paragraph.youtube({
    required String url,
    required String videoId,
    String? thumbnail,
  }) = YouTubeParagraph;

  factory Paragraph.fromJson(Map<String, dynamic> json) =>
      _$ParagraphFromJson(json);
}
```

**é‡è¦**: å¦‚æœåŸæœ¬çš„è¨­è¨ˆæ˜¯æ¯å€‹ Paragraph å­é¡åˆ¥ç¨ç«‹å®šç¾©ï¼Œéœ€è¦æ”¹ç‚º freezed çš„ union typeï¼ˆå¦‚ä¸Šç¯„ä¾‹ï¼‰ï¼Œæˆ–ä¿æŒç¨ç«‹å®šç¾©ä½†çµ±ä¸€ç¹¼æ‰¿è‡ª base classã€‚

---

**æ­¥é©Ÿ 1.2.3**: å‰µå»º Barrel File (30 åˆ†é˜)

å‰µå»º `lib/domain/models/models.dart`:

```dart
// lib/domain/models/models.dart
//
// Barrel file for all domain models
//
// This file re-exports all models for convenient imports.
// You can import all models with: import 'package:news_hub/domain/models/models.dart';
// Or import specific models with: import 'package:news_hub/domain/models/thread/post/single_image_post.dart';

// Common
export 'common/pagination.dart';
export 'common/result.dart';
export 'common/health_check_result.dart';

// Sidecar
export 'sidecar/log_entry.dart';

// Repo
export 'repo/repo.dart';

// Extension
export 'extension/extension.dart';
export 'extension/remote_extension.dart';
export 'extension/extension_with_boards.dart';

// Collection
export 'collection/board_identity.dart';
export 'collection/collection_board.dart';
export 'collection/collection.dart';

// Thread - Paragraph
export 'thread/paragraph/paragraph.dart';
// å¦‚æœ paragraph æ˜¯ç¨ç«‹æª”æ¡ˆï¼Œä¹Ÿè¦ exportï¼š
// export 'thread/paragraph/text_paragraph.dart';
// export 'thread/paragraph/image_paragraph.dart';
// export 'thread/paragraph/video_paragraph.dart';
// export 'thread/paragraph/youtube_paragraph.dart';

// Thread - Post
export 'thread/post/post.dart';
export 'thread/post/single_image_post.dart';
export 'thread/post/article_post.dart';
export 'thread/post/single_image_post_with_extension.dart';

// Thread - Other
export 'thread/comment.dart';
export 'thread/board_data_chunk.dart';

// Board
export 'board/board.dart';

// Bookmark
export 'bookmark/bookmark.dart';

// Suggestion
export 'suggestion/suggestion.dart';
```

---

**æ­¥é©Ÿ 1.2.4**: å¾ Use Case æª”æ¡ˆä¸­ç§»é™¤ Entity å®šç¾© (1 å°æ™‚)

éœ€è¦è™•ç†çš„æª”æ¡ˆï¼š

1. `lib/domain/thread/interactor/get_original_post.dart` â†’ ç§»é™¤ `ArticlePostWithExtension`
2. `lib/domain/extension/interactor/list_installed_extensions.dart` â†’ ç§»é™¤ `ExtensionWithBoards`
3. `lib/domain/extension/interactor/list_extensions.dart` â†’ ç§»é™¤ `Extensions`
4. `lib/domain/thread/interactor/list_collection_threads.dart` â†’ ç§»é™¤ `BoardDataChunk`

**ç¯„ä¾‹**: `get_original_post.dart`:

```dart
// Before (éŒ¯èª¤ âŒ)
@injectable
class GetOriginalPost {
  // ... Use Case é‚è¼¯

  // âŒ Entity å®šç¾©åœ¨ Use Case æª”æ¡ˆä¸­
  class ArticlePostWithExtension {
    final ArticlePost post;
    final Extension extension;
    final Board board;
    // ...
  }
}

// After (æ­£ç¢º âœ…)
import 'package:news_hub/domain/models/models.dart';  // å¾ models å°å…¥
// æˆ–
import 'package:news_hub/domain/models/thread/post/article_post_with_extension.dart';  // ç›´æ¥å°å…¥

@injectable
class GetOriginalPost {
  // ... Use Case é‚è¼¯
  // Entity å®šç¾©å·²ç§»è‡³ lib/domain/models/thread/post/article_post_with_extension.dart
}
```

---

**æ­¥é©Ÿ 1.2.5**: é‹è¡Œä»£ç¢¼ç”Ÿæˆ (15 åˆ†é˜)

```bash
# æ¸…ç†èˆŠçš„ç”Ÿæˆæª”æ¡ˆ
find lib/domain/models -name "*.g.dart" -delete
find lib/domain/models -name "*.freezed.dart" -delete

# é‡æ–°ç”Ÿæˆ
dart run build_runner build --delete-conflicting-outputs

# å¦‚æœå‡ºç¾éŒ¯èª¤ï¼ŒæŸ¥çœ‹éŒ¯èª¤è¨Šæ¯ä¸¦ä¿®æ­£
# å¸¸è¦‹éŒ¯èª¤ï¼šå¾ªç’°ä¾è³´ã€ç¼ºå°‘ importã€freezed è¨»è§£éŒ¯èª¤
```

---

**æ­¥é©Ÿ 1.2.6**: æ›´æ–°æ‰€æœ‰ import èªå¥ (1-1.5 å°æ™‚)

**ç­–ç•¥**: ä¿æŒä½¿ç”¨ Barrel Fileï¼Œä¸éœ€è¦é€ä¸€æ›´æ–°

å¤§éƒ¨åˆ†æª”æ¡ˆå·²ç¶“ä½¿ç”¨ï¼š

```dart
import 'package:news_hub/domain/models/models.dart';
```

é€™äº›æª”æ¡ˆ**ä¸éœ€è¦ä¿®æ”¹**ï¼Œå› ç‚º Barrel File æœƒ re-export æ‰€æœ‰ modelsã€‚

**éœ€è¦æª¢æŸ¥çš„æƒ…æ³**:

1. å¦‚æœæœ‰æª”æ¡ˆç›´æ¥ import èˆŠçš„ models.dart å…§éƒ¨å®šç¾©ï¼ˆæ‡‰è©²æ²’æœ‰ï¼‰
2. å¦‚æœæœ‰æª”æ¡ˆ import Use Case æª”æ¡ˆä¾†ä½¿ç”¨å…¶ä¸­çš„ Entityï¼ˆéœ€è¦æ”¹ç‚º import modelsï¼‰

**é©—è­‰æ–¹æ³•**:

```bash
# æœå°‹æ˜¯å¦æœ‰ç›´æ¥ import Use Case ä¾†ä½¿ç”¨ Entity çš„æƒ…æ³
grep -r "import.*interactor.*" lib/presentation --include="*.dart" | grep -v "cubit\|bloc"
```

---

**æ­¥é©Ÿ 1.2.7**: é©—è­‰å’Œæ¸¬è©¦ (30 åˆ†é˜)

1. **ç·¨è­¯æª¢æŸ¥**:

   ```bash
   flutter analyze
   ```

2. **é‹è¡Œæ¸¬è©¦**:

   ```bash
   flutter test
   ```

3. **æ‰‹å‹•æ¸¬è©¦**:

   - å•Ÿå‹•æ‡‰ç”¨
   - æ¸¬è©¦æ‰€æœ‰ä¸»è¦åŠŸèƒ½æµç¨‹
   - ç¢ºèªæ²’æœ‰ runtime éŒ¯èª¤

4. **VSCode é©—è­‰**:
   - éš¨æ©Ÿé¸æ“‡ 5-10 å€‹ Model
   - ä½¿ç”¨ Cmd+Click (Mac) æˆ– Ctrl+Click (Windows) é»æ“Šå‹åˆ¥åç¨±
   - é©—è­‰èƒ½æ­£ç¢ºè·³è½‰åˆ°å°æ‡‰çš„ç¨ç«‹æª”æ¡ˆï¼ˆè€Œé models.dartï¼‰

##### é©—æ”¶æ¨™æº–

**å¿…é ˆå…¨éƒ¨é€šé** âœ…ï¼š

- [ ] âœ… æ‰€æœ‰ Entity å·²æå–åˆ°ç¨ç«‹æª”æ¡ˆ
- [ ] âœ… æª”æ¡ˆçµæ§‹ç¬¦åˆ After ç¯„ä¾‹çš„ç›®éŒ„çµæ§‹
- [ ] âœ… `models.dart` å·²è½‰æ›ç‚º Barrel Fileï¼ŒåŒ…å«æ‰€æœ‰ export
- [ ] âœ… æ‰€æœ‰ Use Case æª”æ¡ˆä¸­çš„ Entity å®šç¾©å·²ç§»é™¤
- [ ] âœ… `dart run build_runner build` æˆåŠŸåŸ·è¡Œï¼Œç„¡éŒ¯èª¤
- [ ] âœ… `flutter analyze` é›¶éŒ¯èª¤ã€é›¶æ–°å¢è­¦å‘Š
- [ ] âœ… æ‰€æœ‰ç¾æœ‰æ¸¬è©¦é€šé
- [ ] âœ… VSCode "Go to Definition" èƒ½æ­£ç¢ºè·³è½‰åˆ°ç¨ç«‹æª”æ¡ˆ
- [ ] âœ… æ‡‰ç”¨èƒ½æ­£å¸¸å•Ÿå‹•å’Œé‹è¡Œ

**ç¦æ­¢å‡ºç¾** âŒï¼š

- [ ] âŒ Use Case æª”æ¡ˆä¸­ä»æœ‰ class å®šç¾©ï¼ˆé™¤äº† Use Case æœ¬èº«ï¼‰
- [ ] âŒ ä»»ä½• Entity å®šç¾©åœ¨é `models/` ç›®éŒ„ä¸‹
- [ ] âŒ Barrel File ç¼ºå°‘ä»»ä½• Entity çš„ export
- [ ] âŒ ç·¨è­¯éŒ¯èª¤æˆ–æ–°çš„è­¦å‘Š

##### é©—è­‰æ–¹æ³•

**è‡ªå‹•åŒ–é©—è­‰**:

```bash
# 1. æª¢æŸ¥ç›®éŒ„çµæ§‹
test -d lib/domain/models/common && echo "âœ… common ç›®éŒ„å­˜åœ¨" || echo "âŒ ç¼ºå°‘ç›®éŒ„"
test -d lib/domain/models/thread/post && echo "âœ… thread/post ç›®éŒ„å­˜åœ¨" || echo "âŒ ç¼ºå°‘ç›®éŒ„"
test -d lib/domain/models/thread/paragraph && echo "âœ… thread/paragraph ç›®éŒ„å­˜åœ¨" || echo "âŒ ç¼ºå°‘ç›®éŒ„"

# 2. æª¢æŸ¥é—œéµæª”æ¡ˆå­˜åœ¨
test -f lib/domain/models/models.dart && echo "âœ… Barrel file å­˜åœ¨" || echo "âŒ ç¼ºå°‘ Barrel file"
test -f lib/domain/models/thread/post/single_image_post.dart && echo "âœ… SingleImagePost æª”æ¡ˆå­˜åœ¨" || echo "âŒ ç¼ºå°‘æª”æ¡ˆ"

# 3. æª¢æŸ¥ Use Case ä¸­ç„¡ class å®šç¾©ï¼ˆé™¤äº† Use Case æœ¬èº«ï¼‰
! grep -A 5 "^class [^}]*{$" lib/domain/*/interactor/*.dart | grep -v "UseCase\|Interactor" && echo "âœ… Use Case ç„¡é¡å¤– class" || echo "âŒ ä»æœ‰é¡å¤– class"

# 4. éœæ…‹åˆ†æ
flutter analyze

# 5. æ¸¬è©¦
flutter test
```

**æ‰‹å‹•é©—è­‰ - VSCode æ¸¬è©¦**:

1. æ‰“é–‹ä»»ä¸€ Presentation å±¤æª”æ¡ˆï¼ˆå¦‚ `home_screen.dart`ï¼‰
2. æ‰¾åˆ°ä¸€å€‹ Model ä½¿ç”¨ï¼ˆå¦‚ `Collection`ï¼‰
3. Cmd+Click (Mac) é»æ“Š `Collection` å‹åˆ¥
4. **é æœŸè¡Œç‚º**: è·³è½‰åˆ° `lib/domain/models/collection/collection.dart` âœ…
5. **éŒ¯èª¤è¡Œç‚º**: è·³è½‰åˆ° `lib/domain/models/models.dart` ä¸”éœ€è¦æ‰‹å‹•æœå°‹ âŒ

é‡è¤‡æ¸¬è©¦ 5-10 å€‹ä¸åŒçš„ Modelã€‚

##### æ³¨æ„äº‹é …

âš ï¸ **é‡è¦**:

1. **Freezed ç¹¼æ‰¿å•é¡Œ**:

   - Freezed ä¸æ”¯æ´å‚³çµ±ç¹¼æ‰¿ï¼Œä½¿ç”¨ Union Types ä»£æ›¿
   - å¦‚ `Paragraph` æ‡‰è©²æ˜¯ sealed class with union types
   - åƒè€ƒ [Freezed Union Types](https://pub.dev/packages/freezed#union-types-and-sealed-classes)

2. **å¾ªç’°ä¾è³´é¢¨éšª**:

   - `SingleImagePostWithExtension` ä¾è³´ `SingleImagePost`, `Extension`, `Board`
   - ç¢ºä¿ import é †åºæ­£ç¢ºï¼Œé¿å…å¾ªç’°ä¾è³´

3. **Git Commit ç­–ç•¥**:

   - å»ºè­°åˆ†å¤šå€‹ commitï¼š
     - Commit 1: å‰µå»ºç›®éŒ„çµæ§‹
     - Commit 2: æå– common models
     - Commit 3: æå– extension models
     - Commit 4: æå– collection models
     - Commit 5: æå– thread models (æœ€è¤‡é›œ)
     - Commit 6: å‰µå»º Barrel File
     - Commit 7: ç§»é™¤ Use Case ä¸­çš„ Entity å®šç¾©

4. **å»ºè­°ä½¿ç”¨ Git Branch**:
   ```bash
   git checkout -b refactor/split-models-file
   ```

ğŸ“ **å»ºè­°çš„æœ€çµ‚ Commit Message**:

```
refactor(domain): split models.dart into individual files

- Create organized directory structure by bounded context
- Extract all 40+ entities into separate files
- Create barrel file (models.dart) for convenient imports
- Remove entity definitions from Use Case files
- Improve VSCode IDE support (Go to Definition)
- Reduce single file complexity for better maintainability

Changes:
- lib/domain/models/models.dart: 500+ lines â†’ 100 lines (barrel file)
- lib/domain/models/common/: +3 files (pagination, result, health_check)
- lib/domain/models/thread/: +10 files (post, paragraph, comment, etc.)
- lib/domain/models/extension/: +3 files
- lib/domain/models/collection/: +3 files
- lib/domain/models/board/: +1 file
- lib/domain/models/bookmark/: +1 file
- lib/domain/models/suggestion/: +1 file
- lib/domain/models/sidecar/: +1 file
- lib/domain/models/repo/: +1 file

Benefits:
- Better IDE support for VSCode users
- Easier code reviews (per-entity changes)
- Reduced git merge conflicts
- Clearer Single Responsibility Principle
- Faster file navigation

Ref: REFACTORING_PLAN.md Task 1.2
```

---

#### Task 1.3: ç§»é™¤å…¶ä»– Domain å±¤ä¾è³´é•è¦

**å„ªå…ˆç´š**: ğŸ”´ æœ€é«˜
**é ä¼°å·¥æ™‚**: 4-5 å°æ™‚
**å—å½±éŸ¿æª”æ¡ˆ**: 7 å€‹

##### å•é¡Œæè¿°

Domain å±¤ä»æœ‰ä»¥ä¸‹ä¾è³´é•è¦ï¼š

1. âŒ `flutter/widgets.dart` (æœªä½¿ç”¨)
2. âŒ `rxdart` (æŠ€è¡“å¯¦ç¾ç´°ç¯€)
3. âŒ `async` (æŠ€è¡“å¯¦ç¾ç´°ç¯€)
4. âŒ `collection` (å¯ç”¨ dartx æ›¿ä»£)

é€™äº›é•å CLAUDE.md è¦å®šçš„ã€ŒDomain å±¤åªå…è¨±ä¾è³´ï¼šget_it, injectable, dartx, freezed, json_annotation, flutter/foundation.dartã€

##### å­ä»»å‹™æ¸…å–®

**Task 1.3.1**: ç§»é™¤æœªä½¿ç”¨çš„ flutter/widgets import (5 åˆ†é˜)

**Task 1.3.2**: ç§»é™¤ RxDart ä¾è³´ (2-3 å°æ™‚) â­

**Task 1.3.3**: ç§»é™¤ async å¥—ä»¶ä¾è³´ (1-2 å°æ™‚)

**Task 1.3.4**: ç§»é™¤ collection å¥—ä»¶ä¾è³´ (30 åˆ†é˜)

---

##### Task 1.3.1: ç§»é™¤ flutter/widgets import

**æª”æ¡ˆ**: `lib/domain/repo/interactor/add_repo.dart`

**Before**:

```dart
import 'package:flutter/widgets.dart';  // âŒ æœªä½¿ç”¨
import 'package:injectable/injectable.dart';
import 'package:news_hub/domain/repo/repository.dart';

@injectable
class AddRepo {
  // ...
}
```

**After**:

```dart
import 'package:injectable/injectable.dart';
import 'package:news_hub/domain/repo/repository.dart';

@injectable
class AddRepo {
  // ...
}
```

**åŸ·è¡Œæ­¥é©Ÿ**:

1. é–‹å•Ÿ `lib/domain/repo/interactor/add_repo.dart`
2. åˆªé™¤ Line 2: `import 'package:flutter/widgets.dart';`
3. å„²å­˜æª”æ¡ˆ
4. é‹è¡Œ `flutter analyze lib/domain/repo/interactor/add_repo.dart`

**é©—æ”¶æ¨™æº–**:

- [ ] âœ… æª”æ¡ˆä¸­ç„¡ `flutter/widgets` import
- [ ] âœ… `flutter analyze` ç„¡è­¦å‘Š

---

##### Task 1.3.2: ç§»é™¤ RxDart ä¾è³´ â­

**å„ªå…ˆç´š**: ğŸ”´ æœ€é«˜ï¼ˆæœ€è¤‡é›œï¼‰
**æª”æ¡ˆ**: `lib/domain/extension/interactor/list_extensions.dart`

**å•é¡Œåˆ†æ**:

ç•¶å‰ä½¿ç”¨ `CombineLatestStream.combine3` ä¾†åˆä½µä¸‰å€‹ Streamï¼š

```dart
import 'package:rxdart/rxdart.dart';  // âŒ ä¸å…è¨±çš„ä¾è³´

Stream<Extensions> call(String? keywords) {
  return CombineLatestStream.combine3(
    _installedExtensionRepository.watchList(),
    _remoteExtensionRepository.watchList(),
    _repoRepository.watchList(),
    (List<Extension> installed,
     List<RemoteExtension> remote,
     List<Repo> repos) {
      // åˆ†é¡é‚è¼¯...
      return Extensions(...);
    },
  );
}
```

**è§£æ±ºæ–¹æ¡ˆé¸é …**:

**é¸é … A: ä½¿ç”¨ Dart åŸç”Ÿ StreamZip** (æ¨è–¦)

```dart
import 'package:async/async.dart';  // Dart å®˜æ–¹ç¶­è­·çš„å¥—ä»¶

Stream<Extensions> call(String? keywords) {
  return StreamZip([
    _installedExtensionRepository.watchList(),
    _remoteExtensionRepository.watchList(),
    _repoRepository.watchList(),
  ]).map((values) {
    final installed = values[0] as List<Extension>;
    final remote = values[1] as List<RemoteExtension>;
    final repos = values[2] as List<Repo>;

    // åˆ†é¡é‚è¼¯...
    return Extensions(...);
  });
}
```

**å•é¡Œ**: `async` å¥—ä»¶ä¹Ÿä¸åœ¨å…è¨±æ¸…å–®ä¸­ï¼

**é¸é … B: æ‰‹å‹•å¯¦ç¾ combineLatest** (æ¨è–¦ âœ…)

```dart
Stream<Extensions> call(String? keywords) {
  // ä½¿ç”¨ Dart åŸç”Ÿ Stream API æ‰‹å‹•åˆä½µ
  late StreamSubscription<List<Extension>> installedSub;
  late StreamSubscription<List<RemoteExtension>> remoteSub;
  late StreamSubscription<List<Repo>> reposSub;

  List<Extension>? latestInstalled;
  List<RemoteExtension>? latestRemote;
  List<Repo>? latestRepos;

  final controller = StreamController<Extensions>();

  void tryEmit() {
    if (latestInstalled != null &&
        latestRemote != null &&
        latestRepos != null) {
      final result = _classify(
        latestInstalled!,
        latestRemote!,
        latestRepos!,
        keywords,
      );
      controller.add(result);
    }
  }

  installedSub = _installedExtensionRepository.watchList().listen((data) {
    latestInstalled = data;
    tryEmit();
  });

  remoteSub = _remoteExtensionRepository.watchList().listen((data) {
    latestRemote = data;
    tryEmit();
  });

  reposSub = _repoRepository.watchList().listen((data) {
    latestRepos = data;
    tryEmit();
  });

  controller.onCancel = () {
    installedSub.cancel();
    remoteSub.cancel();
    reposSub.cancel();
  };

  return controller.stream;
}

// æå–åˆ†é¡é‚è¼¯ç‚ºç¨ç«‹æ–¹æ³•
Extensions _classify(
  List<Extension> installed,
  List<RemoteExtension> remote,
  List<Repo> repos,
  String? keywords,
) {
  // åŸæœ¬çš„åˆ†é¡é‚è¼¯
  // ...
}
```

**é¸é … C: å‰µå»ºé€šç”¨çš„ CombineLatest Helper** (é€²éš)

åœ¨ `lib/domain/common/` å‰µå»ºé€šç”¨å·¥å…·ï¼š

```dart
// lib/domain/common/stream_utils.dart

/// åˆä½µå¤šå€‹ Stream çš„æœ€æ–°å€¼
///
/// ç•¶ä»»ä¸€ Stream ç™¼å‡ºæ–°å€¼æ™‚ï¼Œå¦‚æœæ‰€æœ‰ Stream éƒ½è‡³å°‘ç™¼å‡ºéä¸€æ¬¡å€¼ï¼Œ
/// å‰‡èª¿ç”¨ combiner å‡½æ•¸ä¸¦ç™¼å‡ºçµæœã€‚
Stream<R> combineLatest3<A, B, C, R>(
  Stream<A> streamA,
  Stream<B> streamB,
  Stream<C> streamC,
  R Function(A, B, C) combiner,
) {
  late StreamSubscription<A> subA;
  late StreamSubscription<B> subB;
  late StreamSubscription<C> subC;

  A? latestA;
  B? latestB;
  C? latestC;

  bool hasA = false;
  bool hasB = false;
  bool hasC = false;

  final controller = StreamController<R>();

  void tryEmit() {
    if (hasA && hasB && hasC) {
      final result = combiner(latestA as A, latestB as B, latestC as C);
      controller.add(result);
    }
  }

  subA = streamA.listen((data) {
    latestA = data;
    hasA = true;
    tryEmit();
  });

  subB = streamB.listen((data) {
    latestB = data;
    hasB = true;
    tryEmit();
  });

  subC = streamC.listen((data) {
    latestC = data;
    hasC = true;
    tryEmit();
  });

  controller.onCancel = () {
    subA.cancel();
    subB.cancel();
    subC.cancel();
  };

  return controller.stream;
}
```

ä½¿ç”¨ï¼š

```dart
import 'package:news_hub/domain/common/stream_utils.dart';

Stream<Extensions> call(String? keywords) {
  return combineLatest3(
    _installedExtensionRepository.watchList(),
    _remoteExtensionRepository.watchList(),
    _repoRepository.watchList(),
    (installed, remote, repos) => _classify(installed, remote, repos, keywords),
  );
}
```

**å»ºè­°**: ä½¿ç”¨ **é¸é … C**ï¼Œå„ªé»ï¼š

- âœ… ç¬¦åˆ DDDï¼ˆDomain å±¤çš„é€šç”¨å·¥å…·ï¼‰
- âœ… å¯é‡ç”¨ï¼ˆå…¶ä»– Use Case ä¹Ÿå¯èƒ½éœ€è¦ï¼‰
- âœ… æ˜“æ–¼æ¸¬è©¦
- âœ… ç„¡å¤–éƒ¨ä¾è³´

**åŸ·è¡Œæ­¥é©Ÿ**:

1. å‰µå»º `lib/domain/common/stream_utils.dart`ï¼Œå¯¦ç¾ `combineLatest3`
2. ç·¨å¯«å–®å…ƒæ¸¬è©¦ `test/domain/common/stream_utils_test.dart`
3. æ›´æ–° `list_extensions.dart` ä½¿ç”¨æ–°å·¥å…·
4. ç§»é™¤ `import 'package:rxdart/rxdart.dart';`
5. æ›´æ–° `pubspec.yaml`ï¼Œç§»é™¤ `rxdart` ä¾è³´ï¼ˆå¦‚æœå…¶ä»–åœ°æ–¹ä¹Ÿä¸ä½¿ç”¨ï¼‰
6. é‹è¡Œæ¸¬è©¦é©—è­‰

**é©—æ”¶æ¨™æº–**:

- [ ] âœ… `stream_utils.dart` å·²å‰µå»ºä¸¦åŒ…å« `combineLatest3`
- [ ] âœ… `list_extensions.dart` å·²æ›´æ–°ä½¿ç”¨æ–°å·¥å…·
- [ ] âœ… ç„¡ `rxdart` import
- [ ] âœ… å–®å…ƒæ¸¬è©¦é€šé
- [ ] âœ… åŠŸèƒ½æ¸¬è©¦ï¼šExtension åˆ—è¡¨æ­£å¸¸é¡¯ç¤ºå’Œæ›´æ–°

---

##### Task 1.3.3: ç§»é™¤ async å¥—ä»¶ä¾è³´

**æª”æ¡ˆ**: `lib/domain/thread/interactor/list_collection_threads.dart`

**å•é¡Œ**: ä½¿ç”¨ `StreamGroup` åˆä½µå¤šå€‹ Stream

**Before**:

```dart
import 'package:async/async.dart';  // âŒ ä¸å…è¨±

final group = StreamGroup<BoardDataChunk>();
for (final board in boards) {
  group.add(_fetchThreadsForBoard(board));
}
return group.stream;
```

**After** (é¸é … 1 - æ¨è–¦):

```dart
// ä½¿ç”¨ Dart åŸç”Ÿ Stream.fromFutures + asyncExpand

Stream<BoardDataChunk> call(String collectionId) async* {
  final collection = await _collectionRepository.get(collectionId);
  final boardDataList = await prepareBoardData(collection);

  // æ–¹æ³• 1: å¾ªåºè™•ç†ï¼ˆç°¡å–®ï¼‰
  for (final boardData in boardDataList) {
    yield* _fetchThreadsForBoard(boardData);
  }

  // æ–¹æ³• 2: ä¸¦è¡Œè™•ç†ï¼ˆé€²éšï¼Œå¦‚éœ€è¦ï¼‰
  // final streams = boardDataList.map(_fetchThreadsForBoard).toList();
  // for (final stream in streams) {
  //   yield* stream;
  // }
}
```

**After** (é¸é … 2 - å¦‚éœ€çœŸæ­£çš„ä¸¦è¡Œåˆä½µ):

å‰µå»º `lib/domain/common/stream_utils.dart` ä¸­æ·»åŠ ï¼š

```dart
/// åˆä½µå¤šå€‹ Stream ç‚ºå–®ä¸€ Stream
Stream<T> mergeStreams<T>(List<Stream<T>> streams) async* {
  final subscriptions = <StreamSubscription<T>>[];
  final controller = StreamController<T>();

  for (final stream in streams) {
    subscriptions.add(stream.listen(
      controller.add,
      onError: controller.addError,
    ));
  }

  yield* controller.stream;

  // æ¸…ç†
  for (final sub in subscriptions) {
    await sub.cancel();
  }
}
```

ä½¿ç”¨ï¼š

```dart
import 'package:news_hub/domain/common/stream_utils.dart';

Stream<BoardDataChunk> call(String collectionId) async* {
  final collection = await _collectionRepository.get(collectionId);
  final boardDataList = await prepareBoardData(collection);

  final streams = boardDataList
      .map((board) => _fetchThreadsForBoard(board))
      .toList();

  yield* mergeStreams(streams);
}
```

**å»ºè­°**:

- å¦‚æœé †åºä¸é‡è¦ä¸”éœ€è¦ä¸¦è¡Œï¼Œä½¿ç”¨**é¸é … 2**
- å¦‚æœé †åºé‡è¦æˆ–ç°¡å–®å³å¯ï¼Œä½¿ç”¨**é¸é … 1**

**åŸ·è¡Œæ­¥é©Ÿ**:

1. æ±ºå®šä½¿ç”¨é¸é … 1 æˆ– 2
2. æ›´æ–° `list_collection_threads.dart`
3. ç§»é™¤ `import 'package:async/async.dart';`
4. æ¸¬è©¦åŠŸèƒ½æ­£å¸¸

**é©—æ”¶æ¨™æº–**:

- [ ] âœ… ç„¡ `async` å¥—ä»¶ import
- [ ] âœ… åŠŸèƒ½æ¸¬è©¦ï¼šCollection è²¼æ–‡åˆ—è¡¨æ­£å¸¸è¼‰å…¥
- [ ] âœ… æ•ˆèƒ½æ¸¬è©¦ï¼šå¤šçœ‹æ¿ä¸¦è¡Œè¼‰å…¥é€Ÿåº¦æœªé™ä½

---

##### Task 1.3.4: ç§»é™¤ collection å¥—ä»¶ä¾è³´

**æª”æ¡ˆ**: `lib/domain/thread/interactor/list_collection_threads.dart`

**å•é¡Œ**: ä½¿ç”¨ `firstWhereOrNull`

**Before**:

```dart
import 'package:collection/collection.dart';  // âŒ ä¸å…è¨±

final board = boards.firstWhereOrNull((b) => b.id == boardId);
```

**After** (é¸é … 1 - ä½¿ç”¨ dartx):

```dart
import 'package:dartx/dartx.dart';  // âœ… å…è¨±

final board = boards.firstOrNullWhere((b) => b.id == boardId);
```

**After** (é¸é … 2 - æ‰‹å‹•å¯¦ç¾):

```dart
// ç„¡é¡å¤– import

Board? findBoard(List<Board> boards, String boardId) {
  try {
    return boards.firstWhere((b) => b.id == boardId);
  } catch (e) {
    return null;
  }
}

// ä½¿ç”¨
final board = findBoard(boards, boardId);
```

**å»ºè­°**: ä½¿ç”¨**é¸é … 1**ï¼ˆdartx æ˜¯å…è¨±çš„ä¾è³´ï¼‰

**åŸ·è¡Œæ­¥é©Ÿ**:

1. ç¢ºä¿ `pubspec.yaml` åŒ…å« `dartx`ï¼ˆæ‡‰è©²å·²æœ‰ï¼‰
2. æ›´æ–° import: `collection/collection.dart` â†’ `dartx/dartx.dart`
3. æ›´æ–°æ–¹æ³•å: `firstWhereOrNull` â†’ `firstOrNullWhere`
4. æ¸¬è©¦åŠŸèƒ½æ­£å¸¸

**é©—æ”¶æ¨™æº–**:

- [ ] âœ… ç„¡ `collection/collection.dart` import
- [ ] âœ… ä½¿ç”¨ `dartx` æˆ–æ‰‹å‹•å¯¦ç¾
- [ ] âœ… åŠŸèƒ½æ­£å¸¸

---

##### æ•´é«”é©—æ”¶æ¨™æº– (Task 1.3)

- [ ] âœ… Domain å±¤ç„¡ `flutter/widgets` import
- [ ] âœ… Domain å±¤ç„¡ `rxdart` import
- [ ] âœ… Domain å±¤ç„¡ `async` å¥—ä»¶ import
- [ ] âœ… Domain å±¤ç„¡ `collection` å¥—ä»¶ import
- [ ] âœ… æ‰€æœ‰åŠŸèƒ½æ¸¬è©¦é€šé
- [ ] âœ… `flutter analyze lib/domain` ç„¡è­¦å‘Š

---

### Phase 2: BLoC æ•ˆèƒ½å„ªåŒ–

**åŸ·è¡Œå‰ç½®æ¢ä»¶**:

- âœ… Phase 1 æ‰€æœ‰ä»»å‹™å·²å®Œæˆ

---

#### Task 2.1: å„ªåŒ– HomeScreen BLoC é‡å»º

**å„ªå…ˆç´š**: ğŸ”´ æœ€é«˜
**é ä¼°å·¥æ™‚**: 3-4 å°æ™‚
**å—å½±éŸ¿æª”æ¡ˆ**: `lib/presentation/pages/home/home_screen.dart`

**ç›®æ¨™**: æ¸›å°‘ 90%+ é‡å»ºæ¬¡æ•¸

**å•é¡Œ**:

- `HomeScreen` ä½¿ç”¨é ‚å±¤ `BlocBuilder` ç›£è½ `HomeCubit`
- ç•¶ `AppTopBar` æ¨™é¡Œæ”¹è®Šæ™‚ï¼Œæ•´å€‹ `Scaffold` (åŒ…å« `Drawer`, `Router`) éƒ½æœƒé‡å»º
- å°è‡´ `Drawer` å‹•ç•«å¡é “ï¼Œè·¯ç”±åˆ‡æ›ä¸æµæš¢

**è§£æ±ºæ–¹æ¡ˆ**:

1. ç§»é™¤ `HomeScreen` é ‚å±¤ `BlocBuilder`
2. å°‡ `AppTopBar` åŒ…è£¹åœ¨ `BlocSelector` ä¸­ï¼Œåªç›£è½ `state.title`
3. ç¢ºä¿ `Drawer` å…§éƒ¨è‡ªè¡Œç®¡ç†ç‹€æ…‹ç›£è½

**é©—æ”¶æ¨™æº–**:

- [ ] âœ… ç§»é™¤é ‚å±¤ `BlocBuilder`
- [ ] âœ… æ¨™é¡Œè®Šæ›´æ™‚ï¼Œåªé‡å»º `AppTopBar`
- [ ] âœ… `Drawer` å±•é–‹/æ”¶èµ·æ™‚ç„¡æ‰å¹€ (`60 FPS`)

---

#### Task 2.2: å„ªåŒ– SidecarLogsScreen æ•ˆèƒ½

**å„ªå…ˆç´š**: ğŸ”´ æœ€é«˜
**é ä¼°å·¥æ™‚**: 2-3 å°æ™‚
**å—å½±éŸ¿æª”æ¡ˆ**: `lib/presentation/pages/sidecar_logs/sidecar_logs_screen.dart`

**ç›®æ¨™**: ç¶­æŒ 60 FPS

**å•é¡Œ**:

- æ—¥èªŒåˆ—è¡¨å¯èƒ½åŒ…å«æ•¸åƒæ¢è¨˜éŒ„
- å¦‚æœä½¿ç”¨ `ListView` æœªé–‹å•Ÿ `itemExtent` æˆ–æœªå„ªåŒ– `build`ï¼Œæ»¾å‹•æœƒå¡é “

**è§£æ±ºæ–¹æ¡ˆ**:

1. ä½¿ç”¨ `ListView.builder` æ­é… `itemExtent` (å¦‚æœé«˜åº¦å›ºå®š)
2. ç¢ºä¿ Log Item æ˜¯ `const` widget
3. é¿å…åœ¨ build æ–¹æ³•ä¸­é€²è¡Œè¤‡é›œçš„å­—ä¸²è™•ç†æˆ–æ—¥æœŸæ ¼å¼åŒ–ï¼ˆç§»è‡³ ViewModel æˆ–é è™•ç†ï¼‰

---

#### Task 2.3: å„ªåŒ– ThreadDetailScreen context.watch

**å„ªå…ˆç´š**: ğŸŸ¡ é«˜
**é ä¼°å·¥æ™‚**: 2-3 å°æ™‚

**å•é¡Œ**:

- `ThreadDetailScreen` å¯èƒ½éåº¦ä½¿ç”¨ `context.watch<ThreadDetailCubit>()`
- å°è‡´ä»»ä½•ç´°å¾®ç‹€æ…‹è®Šæ›´ï¼ˆå¦‚è¼‰å…¥é€²åº¦ï¼‰éƒ½è§¸ç™¼æ•´å€‹é é¢é‡å»º

**è§£æ±ºæ–¹æ¡ˆ**:

- ä½¿ç”¨ `BlocSelector` æˆ–ç´°ç²’åº¦çš„ `BlocBuilder`

---

#### Task 2.4-2.8: å…¶ä»–é é¢ BLoC å„ªåŒ–

(ä¿ç•™çµ¦å¾ŒçºŒè©³ç´°è¦åŠƒ)

---

### Phase 3: Use Case é‡æ§‹ (Refactoring)

**èªªæ˜**: æœ¬éšæ®µç›®æ¨™æ˜¯å°‡ Use Case æ‹†åˆ†ç‚ºç¬¦åˆå–®ä¸€è·è²¬åŸå‰‡ (SRP) çš„é¡åˆ¥ï¼Œä¸¦æ¸…é™¤æŠ€è¡“å‚µã€‚

---

#### Task 3.1: ç°¡åŒ– ListCollectionThreads Use Case

**å„ªå…ˆç´š**: ğŸŸ¡ é«˜
**é ä¼°å·¥æ™‚**: 3-4 å°æ™‚
**å—å½±éŸ¿æª”æ¡ˆ**: 1 å€‹

##### å•é¡Œæè¿°

**ç•¶å‰ç‹€æ³**:

```
æª”æ¡ˆ: lib/domain/thread/interactor/list_collection_threads.dart
è¡Œæ•¸: 126 è¡Œ
```

**å•é¡Œ**:

1. **é•åå–®ä¸€è·è²¬åŸå‰‡**: åŒæ™‚è² è²¬ 5 å€‹è·è²¬

   - ç²å– Collection è³‡æ–™
   - æº–å‚™çœ‹æ¿è³‡æ–™ï¼ˆExtension + Board çµ„åˆï¼‰
   - ä¸¦è¡Œè«‹æ±‚å”èª¿
   - Stream åˆä½µ
   - éŒ¯èª¤è™•ç†å’Œè³‡æ–™è½‰æ›

2. **åŒ…å«å…§éƒ¨é¡åˆ¥å®šç¾©**: `BoardDataChunk` æ‡‰ç§»è‡³ modelsï¼ˆåœ¨ Task 1.2 å·²è™•ç†ï¼‰

3. **å‰µå»ºè‡¨æ™‚å°è±¡**: å¡«å……ç©ºå€¼çš„ `tempBoard` å’Œ `tempExtension`

4. **è¤‡é›œçš„ Stream æ§åˆ¶é‚è¼¯**: ä½¿ç”¨ `StreamGroup`, `unawaited` ç­‰

**ç›®æ¨™**:

- âœ… ç¬¦åˆå–®ä¸€è·è²¬åŸå‰‡
- âœ… æ¸›å°‘è¡Œæ•¸è‡³ < 80 è¡Œ
- âœ… æé«˜å¯è®€æ€§å’Œå¯æ¸¬è©¦æ€§
- âœ… éµå¾ª YAGNI åŸå‰‡ï¼ˆä¸éåº¦è¨­è¨ˆï¼‰

---

#### Task 3.2: ç°¡åŒ– ListExtensions Use Case

**å„ªå…ˆç´š**: ï¿½ ä¸­
**é ä¼°å·¥æ™‚**: 3-4 å°æ™‚
**å—å½±éŸ¿æª”æ¡ˆ**: 1 å€‹

**ç›®æ¨™**:

- ç§»é™¤ RxDart ä¾è³´ (Task 1.3 å·²å®Œæˆ)
- æå–è¼”åŠ©é‚è¼¯ç‚º public functions
- ä¿æŒå–®ä¸€è·è²¬

---

#### Task 3.3: ç°¡åŒ– SearchThreads Use Case

**å„ªå…ˆç´š**: ï¿½ ä¸­
**é ä¼°å·¥æ™‚**: 3-4 å°æ™‚
**å—å½±éŸ¿æª”æ¡ˆ**: 1 å€‹

**ç›®æ¨™**:

- ç°¡åŒ–ä¸¦è¡Œæœå°‹é‚è¼¯
- æå–è¼”åŠ©æ–¹æ³•

##### è§£æ±ºæ–¹æ¡ˆ

**åŸå‰‡**:

- ä¿æŒè¼”åŠ©é‚è¼¯ç‚º **public functions** åœ¨åŒä¸€æª”æ¡ˆ
- åªæœ‰åœ¨ç¢ºå¯¦éœ€è¦é‡ç”¨æ™‚æ‰æå–ç‚ºç¨ç«‹ Use Case
- æ·»åŠ æ¸…æ™°è¨»é‡‹èªªæ˜å¯èƒ½çš„é‡æ§‹è·¯å¾‘

**é‡æ§‹ç­–ç•¥**:

1. å°‡ `BoardDataChunk` ç§»è‡³ modelsï¼ˆTask 1.2 å·²å®Œæˆï¼‰
2. æå–è¼”åŠ©æ–¹æ³•ç‚º public functions
3. ç§»é™¤è‡¨æ™‚å°è±¡å‰µå»ºï¼Œä½¿ç”¨çœŸå¯¦è³‡æ–™
4. ç°¡åŒ– Stream æ§åˆ¶é‚è¼¯

##### Before (ç•¶å‰ç‹€æ…‹ - ç°¡åŒ–ç‰ˆ)

```dart
// lib/domain/thread/interactor/list_collection_threads.dart (126 è¡Œ)

@injectable
class ListCollectionThreads {
  Stream<BoardDataChunk> call(String collectionId) async* {
    // 1. ç²å– Collection
    final collection = await _collectionRepository.get(collectionId);

    // 2. æº–å‚™çœ‹æ¿è³‡æ–™ï¼ˆè¤‡é›œé‚è¼¯ï¼‰
    final boardDataList = <BoardData>[];
    for (final b in collection.boards) {
      final extension = await _extensionRepository.get(b.identity.extensionPkgName);
      boardDataList.add(BoardData(extension: extension, board: b));
    }

    // 3. ä¸¦è¡Œè«‹æ±‚ + Stream åˆä½µï¼ˆä½¿ç”¨ StreamGroupï¼‰
    final group = StreamGroup<BoardDataChunk>();
    for (final boardData in boardDataList) {
      group.add(_fetchAndEnrich(boardData));  // è¤‡é›œçš„å…§éƒ¨æ–¹æ³•
    }

    yield* group.stream;
  }

  Stream<BoardDataChunk> _fetchAndEnrich(BoardData boardData) async* {
    // ç²å– + çµ„è£é‚è¼¯ï¼ˆ30+ è¡Œï¼‰
    // ...

    // å‰µå»ºè‡¨æ™‚å°è±¡
    final tempBoard = Board(
      extensionPkgName: boardData.board.identity.extensionPkgName,
      id: boardData.board.identity.boardId,
      name: boardData.board.identity.boardName,
      icon: '',  // âŒ ç©ºå€¼
      largeWelcomeImage: '',  // âŒ ç©ºå€¼
      url: '',  // âŒ ç©ºå€¼
      sortOptions: {},  // âŒ ç©ºå€¼
      selectedSort: boardData.board.selectedSort,
      collectionId: boardData.board.collectionId,
    );

    // ...
  }

  // å…§éƒ¨é¡åˆ¥å®šç¾©ï¼ˆâŒ æ‡‰ç§»è‡³ modelsï¼‰
  class BoardDataChunk {
    final CollectionBoard board;
    final List<SingleImagePostWithExtension> threads;
    final bool isLoading;
    final String? error;
  }
}
```

##### After (é‡æ§‹å¾Œ)

```dart
// lib/domain/thread/interactor/list_collection_threads.dart (~70 è¡Œ)

import 'package:injectable/injectable.dart';
import 'package:news_hub/domain/models/models.dart';
import 'package:news_hub/domain/collection/repository.dart';
import 'package:news_hub/domain/extension/repository.dart';
import 'package:news_hub/domain/board/repository.dart';
import 'package:news_hub/domain/thread/repository.dart';

/// ç²å– Collection ä¸­æ‰€æœ‰çœ‹æ¿çš„è²¼æ–‡åˆ—è¡¨
///
/// æ­¤ Use Case è² è²¬å”èª¿å¤šå€‹çœ‹æ¿çš„è²¼æ–‡ç²å–æµç¨‹ï¼Œ
/// ä¸¦å°‡çµæœä»¥ Stream çš„å½¢å¼é€å€‹ç™¼é€ã€‚
@injectable
class ListCollectionThreads {
  final CollectionRepository _collectionRepository;
  final ThreadRepository _threadRepository;
  final ExtensionRepository _extensionRepository;
  final BoardRepository _boardRepository;

  ListCollectionThreads(
    this._collectionRepository,
    this._threadRepository,
    this._extensionRepository,
    this._boardRepository,
  );

  /// ä¸»è¦å…¬é–‹æ–¹æ³•ï¼šç²å–æŒ‡å®š Collection çš„æ‰€æœ‰è²¼æ–‡
  ///
  /// [collectionId] Collection çš„å”¯ä¸€è­˜åˆ¥ç¢¼
  ///
  /// Returns: Stream<BoardDataChunk>ï¼Œæ¯å€‹çœ‹æ¿å®Œæˆè¼‰å…¥æ™‚ç™¼å‡ºä¸€å€‹ chunk
  Stream<BoardDataChunk> call(String collectionId) async* {
    final collection = await _collectionRepository.get(collectionId);
    final boardDataList = await prepareBoardData(collection);

    // é †åºè™•ç†æ¯å€‹çœ‹æ¿ï¼ˆç°¡å–®ä¸”ç©©å®šï¼‰
    for (final boardData in boardDataList) {
      yield* _fetchThreadsForBoard(boardData);
    }

    // é€²éšï¼šå¦‚éœ€ä¸¦è¡Œè™•ç†ï¼Œå¯ä½¿ç”¨ mergeStreams (lib/domain/common/stream_utils.dart)
    // final streams = boardDataList.map(_fetchThreadsForBoard).toList();
    // yield* mergeStreams(streams);
  }

  /// æº–å‚™çœ‹æ¿è³‡æ–™ï¼šå°‡ CollectionBoard è½‰æ›ç‚ºåŒ…å«å®Œæ•´ Extension è³‡è¨Šçš„ BoardData
  ///
  /// æ­¤æ–¹æ³•ç‚ºå…¬é–‹æ–¹æ³•ï¼Œå› ç‚ºï¼š
  /// 1. éœ€è¦è¢«å–®å…ƒæ¸¬è©¦
  /// 2. æœªä¾†å…¶ä»– Use Case å¯èƒ½éœ€è¦ç›¸åŒé‚è¼¯ï¼ˆå±†æ™‚å¯æå–ç‚ºç¨ç«‹ Use Caseï¼‰
  ///
  /// [collection] è¦è™•ç†çš„ Collection
  ///
  /// Returns: åŒ…å« Extension è³‡è¨Šçš„ BoardData åˆ—è¡¨
  @visibleForTesting
  Future<List<BoardData>> prepareBoardData(Collection collection) async {
    final results = <BoardData>[];

    for (final board in collection.boards) {
      final extension = await _extensionRepository.get(
        board.identity.extensionPkgName,
      );

      results.add(BoardData(
        extension: extension,
        board: board,
      ));
    }

    return results;
  }

  /// ç²å–å–®ä¸€çœ‹æ¿çš„è²¼æ–‡ä¸¦çµ„è£å®Œæ•´è³‡æ–™
  ///
  /// [boardData] åŒ…å« Extension å’Œ Board è³‡è¨Šçš„è³‡æ–™å°è±¡
  ///
  /// Returns: Stream<BoardDataChunk>ï¼Œç™¼å‡ºè©²çœ‹æ¿çš„è²¼æ–‡è³‡æ–™
  Stream<BoardDataChunk> _fetchThreadsForBoard(BoardData boardData) async* {
    // ç™¼å‡ºè¼‰å…¥ä¸­ç‹€æ…‹
    yield BoardDataChunk(
      board: boardData.board,
      threads: [],
      isLoading: true,
    );

    try {
      final threads = await _threadRepository.listThreads(
        extensionPkgName: boardData.extension.pkgName,
        boardId: boardData.board.identity.boardId,
        sort: boardData.board.selectedSort,
      );

      // çµ„è£è²¼æ–‡è³‡æ–™
      final enrichedThreads = threads
          .whereType<SingleImagePost>()
          .map((post) => enrichPostWithExtension(post, boardData))
          .toList();

      yield BoardDataChunk(
        board: boardData.board,
        threads: enrichedThreads,
        isLoading: false,
      );
    } catch (e) {
      yield BoardDataChunk(
        board: boardData.board,
        threads: [],
        isLoading: false,
        error: e.toString(),
      );
    }
  }

  /// çµ„è£è²¼æ–‡è³‡æ–™ï¼šç‚º Post é™„åŠ  Extension å’Œ Board è³‡è¨Š
  ///
  /// æ­¤æ–¹æ³•ç‚ºå…¬é–‹æ–¹æ³•ï¼Œå› ç‚ºï¼š
  /// 1. éœ€è¦è¢«å–®å…ƒæ¸¬è©¦
  /// 2. é‚è¼¯æ¸…æ™°ï¼Œä¾¿æ–¼ç¶­è­·
  ///
  /// [post] åŸå§‹è²¼æ–‡è³‡æ–™
  /// [boardData] åŒ…å« Extension å’Œ Board çš„è³‡æ–™å°è±¡
  ///
  /// Returns: åŒ…å«å®Œæ•´è³‡è¨Šçš„è²¼æ–‡å°è±¡
  @visibleForTesting
  SingleImagePostWithExtension enrichPostWithExtension(
    SingleImagePost post,
    BoardData boardData,
  ) {
    return SingleImagePostWithExtension(
      post: post,
      board: _createMinimalBoard(boardData),
      extension: boardData.extension,
    );
  }

  /// å‰µå»ºæœ€å°åŒ–çš„ Board å°è±¡ï¼ˆåªåŒ…å«å¿…è¦è³‡è¨Šï¼‰
  ///
  /// é¿å…å‰µå»ºå¡«å……ç©ºå€¼çš„è‡¨æ™‚å°è±¡ï¼Œä½¿ç”¨ minimal DTO ä»£æ›¿
  Board _createMinimalBoard(BoardData boardData) {
    return Board(
      extensionPkgName: boardData.extension.pkgName,
      id: boardData.board.identity.boardId,
      name: boardData.board.identity.boardName,
      icon: '',  // æš«æ™‚ä¿ç•™ç©ºå€¼ï¼ˆå¦‚éœ€å®Œæ•´è³‡æ–™ï¼Œä½¿ç”¨ _boardRepository.getBoardï¼‰
      largeWelcomeImage: '',
      url: '',
      sortOptions: const {},
      selectedSort: boardData.board.selectedSort,
      collectionId: boardData.board.collectionId,
    );
  }
}

/// è¼”åŠ©è³‡æ–™é¡åˆ¥ï¼šçµ„åˆ Extension å’Œ CollectionBoard è³‡è¨Š
///
/// ç”¨æ–¼åœ¨ Use Case å…§éƒ¨å‚³éè³‡æ–™ï¼Œé¿å…å¤šæ¬¡æŸ¥è©¢ç›¸åŒè³‡æ–™
class BoardData {
  final Extension extension;
  final CollectionBoard board;

  const BoardData({
    required this.extension,
    required this.board,
  });
}
```

##### é—œéµæ”¹é€²é»

1. âœ… **å–®ä¸€è·è²¬**: ä¸»æ–¹æ³• `call()` åªè² è²¬å”èª¿æµç¨‹
2. âœ… **å…¬é–‹è¼”åŠ©æ–¹æ³•**: ä½¿ç”¨ `@visibleForTesting` æ¨™è¨˜ï¼Œå¯æ¸¬è©¦ä½†ä¸é¼“å‹µå¤–éƒ¨ä½¿ç”¨
3. âœ… **æ¸…æ™°çš„æ–‡ä»¶è¨»é‡‹**: èªªæ˜æ–¹æ³•ç”¨é€”å’Œæœªä¾†é‡æ§‹è·¯å¾‘
4. âœ… **ç§»é™¤ StreamGroup**: æ”¹ç”¨ç°¡å–®çš„ for å¾ªç’°ï¼ˆé †åºè™•ç†ï¼‰
5. âœ… **æä¾›é€²éšé¸é …**: è¨»é‡‹ä¸­èªªæ˜å¦‚ä½•æ”¹ç‚ºä¸¦è¡Œè™•ç†
6. âœ… **æ¸›å°‘è‡¨æ™‚å°è±¡**: æ”¹ç”¨ `_createMinimalBoard`ï¼ˆä»æœ‰ç©ºå€¼ï¼Œä½†æ›´æ¸…æ™°ï¼‰
7. âœ… **è¡Œæ•¸æ¸›å°‘**: å¾ 126 è¡Œ â†’ ~70 è¡Œ

##### åŸ·è¡Œæ­¥é©Ÿ

**æ­¥é©Ÿ 3.1.1**: å‚™ä»½å’Œå‰µå»ºåˆ†æ”¯ (5 åˆ†é˜)

```bash
# å‰µå»ºå‚™ä»½
cp lib/domain/thread/interactor/list_collection_threads.dart \
   lib/domain/thread/interactor/list_collection_threads.dart.backup

# å‰µå»º git åˆ†æ”¯
git checkout -b refactor/simplify-list-collection-threads
```

---

**æ­¥é©Ÿ 3.1.2**: æå– prepareBoardData æ–¹æ³• (30 åˆ†é˜)

1. åœ¨ `list_collection_threads.dart` ä¸­æ·»åŠ æ–°æ–¹æ³•ï¼š

```dart
@visibleForTesting
Future<List<BoardData>> prepareBoardData(Collection collection) async {
  // å¯¦ç¾å¦‚ After ç¯„ä¾‹
}
```

2. æ›´æ–° `call()` æ–¹æ³•ä½¿ç”¨æ–°æ–¹æ³•ï¼š

```dart
Stream<BoardDataChunk> call(String collectionId) async* {
  final collection = await _collectionRepository.get(collectionId);
  final boardDataList = await prepareBoardData(collection);  // â† ä½¿ç”¨æ–°æ–¹æ³•

  // åŸæœ‰é‚è¼¯...
}
```

3. ç·¨å¯«æ¸¬è©¦é©—è­‰åŠŸèƒ½ä¸€è‡´

---

**æ­¥é©Ÿ 3.1.3**: æå– enrichPostWithExtension æ–¹æ³• (20 åˆ†é˜)

1. æ·»åŠ æ–°æ–¹æ³•ï¼ˆå¦‚ After ç¯„ä¾‹ï¼‰
2. æ›´æ–°ä½¿ç”¨è™•
3. æ¸¬è©¦

---

**æ­¥é©Ÿ 3.1.4**: ç°¡åŒ– Stream æ§åˆ¶é‚è¼¯ (1 å°æ™‚)

1. ç§»é™¤ `StreamGroup` ç›¸é—œç¨‹å¼ç¢¼
2. æ”¹ç”¨ç°¡å–®çš„ `for` å¾ªç’°ï¼ˆå¦‚ After ç¯„ä¾‹ï¼‰
3. æ¸¬è©¦åŠŸèƒ½å’Œæ•ˆèƒ½

---

**æ­¥é©Ÿ 3.1.5**: å‰µå»º BoardData è¼”åŠ©é¡åˆ¥ (15 åˆ†é˜)

1. åœ¨æª”æ¡ˆåº•éƒ¨æ·»åŠ  `BoardData` é¡åˆ¥å®šç¾©
2. æ›´æ–°æ‰€æœ‰ä½¿ç”¨è™•

---

**æ­¥é©Ÿ 3.1.6**: æ·»åŠ æ–‡ä»¶è¨»é‡‹ (30 åˆ†é˜)

1. ç‚ºæ¯å€‹ public æ–¹æ³•æ·»åŠ è©³ç´°è¨»é‡‹ï¼ˆå¦‚ After ç¯„ä¾‹ï¼‰
2. èªªæ˜æ–¹æ³•ç”¨é€”ã€åƒæ•¸ã€è¿”å›å€¼
3. èªªæ˜æœªä¾†é‡æ§‹è·¯å¾‘

---

**æ­¥é©Ÿ 3.1.7**: é©—è­‰å’Œæ¸¬è©¦ (1 å°æ™‚)

1. **å–®å…ƒæ¸¬è©¦** (å¦‚æœå­˜åœ¨):

   ```bash
   flutter test test/domain/thread/interactor/list_collection_threads_test.dart
   ```

2. **æ•´åˆæ¸¬è©¦** (å»ºè­°æ–°å¢):

   - æ¸¬è©¦å–®ä¸€çœ‹æ¿
   - æ¸¬è©¦å¤šçœ‹æ¿
   - æ¸¬è©¦éŒ¯èª¤è™•ç†

3. **æ‰‹å‹•åŠŸèƒ½æ¸¬è©¦**:

   - å•Ÿå‹•æ‡‰ç”¨
   - å°èˆªè‡³ Collection è²¼æ–‡åˆ—è¡¨é é¢
   - é©—è­‰ï¼š
     - [ ] è²¼æ–‡æ­£å¸¸è¼‰å…¥
     - [ ] å¤šçœ‹æ¿è³‡æ–™æ­£ç¢ºé¡¯ç¤º
     - [ ] éŒ¯èª¤è™•ç†æ­£å¸¸
     - [ ] æ•ˆèƒ½æœªé™ä½

4. **æ•ˆèƒ½æ¸¬è©¦**:
   - ä½¿ç”¨ Flutter DevTools Performance
   - è¨˜éŒ„é‡æ§‹å‰å¾Œçš„è¼‰å…¥æ™‚é–“
   - ç¢ºä¿ç„¡æ˜é¡¯æ•ˆèƒ½é™ä½

---

##### é©—æ”¶æ¨™æº–

**å¿…é ˆå…¨éƒ¨é€šé** âœ…ï¼š

- [ ] âœ… `prepareBoardData` æ–¹æ³•å·²æå–ç‚º public function
- [ ] âœ… `enrichPostWithExtension` æ–¹æ³•å·²æå–ç‚º public function
- [ ] âœ… `BoardData` è¼”åŠ©é¡åˆ¥å·²å‰µå»º
- [ ] âœ… `StreamGroup` å·²ç§»é™¤ï¼Œæ”¹ç”¨ç°¡å–®å¾ªç’°
- [ ] âœ… æ‰€æœ‰ public æ–¹æ³•éƒ½æœ‰è©³ç´°æ–‡ä»¶è¨»é‡‹
- [ ] âœ… æª”æ¡ˆè¡Œæ•¸ < 80 è¡Œ
- [ ] âœ… `flutter analyze` ç„¡æ–°å¢è­¦å‘Š
- [ ] âœ… æ‰€æœ‰æ¸¬è©¦é€šéï¼ˆå¦‚æœ‰ï¼‰
- [ ] âœ… åŠŸèƒ½æ¸¬è©¦ï¼šCollection è²¼æ–‡åˆ—è¡¨æ­£å¸¸è¼‰å…¥
- [ ] âœ… æ•ˆèƒ½æ¸¬è©¦ï¼šè¼‰å…¥æ™‚é–“æœªæ˜é¡¯å¢åŠ 

**ç¦æ­¢å‡ºç¾** âŒï¼š

- [ ] âŒ ä»ä½¿ç”¨ `StreamGroup`ï¼ˆé™¤éè¨»é‡‹èªªæ˜ï¼‰
- [ ] âŒ ä»æœ‰è‡¨æ™‚å°è±¡å¡«å……ç©ºå€¼ï¼ˆé™¤éä½¿ç”¨ `_createMinimalBoard`ï¼‰
- [ ] âŒ ä»æœ‰å…§éƒ¨é¡åˆ¥å®šç¾©ï¼ˆ`BoardDataChunk` æ‡‰åœ¨ modelsï¼‰
- [ ] âŒ public æ–¹æ³•ç¼ºå°‘æ–‡ä»¶è¨»é‡‹
- [ ] âŒ æ•ˆèƒ½æ˜é¡¯é™ä½ï¼ˆè¼‰å…¥æ™‚é–“å¢åŠ  > 20%ï¼‰

##### é©—è­‰æ–¹æ³•

**è‡ªå‹•åŒ–é©—è­‰**:

```bash
# 1. æª¢æŸ¥è¡Œæ•¸
wc -l lib/domain/thread/interactor/list_collection_threads.dart
# é æœŸï¼š< 80 è¡Œï¼ˆä¸å«ç©ºè¡Œå’Œè¨»é‡‹ï¼‰

# 2. æª¢æŸ¥ç„¡ StreamGroup ä½¿ç”¨
! grep -q "StreamGroup" lib/domain/thread/interactor/list_collection_threads.dart && \
  echo "âœ… ç„¡ StreamGroup" || echo "âŒ ä»ä½¿ç”¨ StreamGroup"

# 3. æª¢æŸ¥ç„¡å…§éƒ¨é¡åˆ¥å®šç¾©ï¼ˆé™¤äº† BoardDataï¼‰
! grep -q "class BoardDataChunk" lib/domain/thread/interactor/list_collection_threads.dart && \
  echo "âœ… BoardDataChunk å·²ç§»è‡³ models" || echo "âŒ ä»æœ‰å…§éƒ¨é¡åˆ¥"

# 4. éœæ…‹åˆ†æ
flutter analyze lib/domain/thread/interactor/list_collection_threads.dart

# 5. æ¸¬è©¦
flutter test test/domain/thread/interactor/
```

**æ‰‹å‹•é©—è­‰**:

1. Code Review:

   - é–±è®€é‡æ§‹å¾Œçš„ç¨‹å¼ç¢¼
   - ç¢ºèªé‚è¼¯æ¸…æ™°æ˜“æ‡‚
   - ç¢ºèªæ–‡ä»¶è¨»é‡‹å®Œæ•´

2. åŠŸèƒ½é©—è­‰:

   - é–‹å•Ÿæ‡‰ç”¨
   - æ¸¬è©¦ Collection è²¼æ–‡åˆ—è¡¨åŠŸèƒ½
   - é©—è­‰å¤šçœ‹æ¿è³‡æ–™æ­£ç¢º

3. æ•ˆèƒ½é©—è­‰:
   - ä½¿ç”¨ Flutter DevTools Performance
   - å°æ¯”é‡æ§‹å‰å¾Œçš„æ•ˆèƒ½æ•¸æ“š

##### æ³¨æ„äº‹é …

âš ï¸ **é‡è¦**:

1. **æ¸¬è©¦å„ªå…ˆ**: å¦‚æœé‚„æ²’æœ‰å–®å…ƒæ¸¬è©¦ï¼Œå…ˆç·¨å¯«æ¸¬è©¦å†é‡æ§‹
2. **å°æ­¥é‡æ§‹**: ä¸è¦ä¸€æ¬¡ä¿®æ”¹å¤ªå¤šï¼Œæ¯å€‹æ­¥é©Ÿéƒ½è¦æ¸¬è©¦
3. **ä¿æŒåŠŸèƒ½ä¸€è‡´**: é‡æ§‹ä¸æ”¹è®Šè¡Œç‚ºï¼Œåªæ”¹è®Šçµæ§‹
4. **æ•ˆèƒ½ç›£æ§**: å¾ä¸¦è¡Œæ”¹ç‚ºé †åºè™•ç†å¯èƒ½å½±éŸ¿æ•ˆèƒ½ï¼Œéœ€ç›£æ§

âš ï¸ **è‡¨æ™‚å°è±¡å•é¡Œ**:

ç•¶å‰æ–¹æ¡ˆä»æœ‰ `_createMinimalBoard` å¡«å……ç©ºå€¼ã€‚å¦‚éœ€å¾¹åº•è§£æ±ºï¼š

**é¸é … A**: ç²å–çœŸå¯¦ Board è³‡æ–™

```dart
// åœ¨ prepareBoardData ä¸­
final realBoard = await _boardRepository.getBoard(
  boardId: board.identity.boardId,
  collectionId: collection.id,
);
```

**é¸é … B**: å‰µå»º MinimalBoard DTO

```dart
@freezed
class MinimalBoard with _$MinimalBoard {
  const factory MinimalBoard({
    required String extensionPkgName,
    required String id,
    required String name,
    required String selectedSort,
    required String collectionId,
  }) = _MinimalBoard;
}
```

**å»ºè­°**: ç•¶å‰ä¿æŒ `_createMinimalBoard`ï¼Œæœªä¾†å¦‚æœ‰éœ€æ±‚å†å„ªåŒ–

ğŸ“ **å»ºè­°çš„ Commit Message**:

```
refactor(domain): simplify ListCollectionThreads Use Case

Simplify ListCollectionThreads by extracting helper methods as public
functions within the same file, following YAGNI principle.

Changes:
- Extract prepareBoardData as public @visibleForTesting method
- Extract enrichPostWithExtension as public @visibleForTesting method  - Remove StreamGroup dependency, use simple for-loop instead
- Create BoardData helper class for internal data passing
- Add comprehensive documentation for all public methods
- Reduce file complexity: 126 lines â†’ ~70 lines

Benefits:
- Better testability (public helper methods)
- Improved readability (clear separation of concerns)
- No over-engineering (keep helpers in same file until reuse needed)
- Easier maintenance (well-documented code)

Note: Helper methods marked as @visibleForTesting to indicate they are
public for testing purposes only. If other Use Cases need these methods
in the future, they can be extracted to separate Use Cases.

Ref: REFACTORING_PLAN.md Task 3.1
```

---

## ğŸ¯ ç¸½çµèˆ‡å»ºè­°

### æ›´æ–°é‡é»

1. **Task 1.1** - æ˜ç¢ºä½¿ç”¨æ¥­å‹™èªè¨€ï¼ˆExtensionSettingsï¼‰æ›¿ä»£æŠ€è¡“è¡“èªï¼ˆPreferencesï¼‰
2. **Task 1.2** - è©³ç´°çš„æª”æ¡ˆæ‹†åˆ†æ­¥é©Ÿï¼Œç¬¦åˆ VSCode ä½¿ç”¨è€…éœ€æ±‚
3. **Task 3.1** - éµå¾ª YAGNI åŸå‰‡ï¼Œä¿æŒè¼”åŠ©æ–¹æ³•ç‚º public functionsï¼Œä¸éåº¦è¨­è¨ˆ

### Spec-Driven Development è¦ç´ 

âœ… æ¯å€‹ä»»å‹™åŒ…å«ï¼š

- å•é¡Œæè¿°ï¼ˆWhyï¼‰
- è§£æ±ºæ–¹æ¡ˆï¼ˆWhatï¼‰
- Before/After ç¨‹å¼ç¢¼ç¯„ä¾‹
- é€æ­¥åŸ·è¡Œæ­¥é©Ÿï¼ˆHowï¼‰
- æ˜ç¢ºé©—æ”¶æ¨™æº–
- è‡ªå‹•åŒ–é©—è­‰è…³æœ¬

### çµ¦ AI Agent åŸ·è¡Œè€…çš„æç¤º

1. **åš´æ ¼éµå¾ªæ­¥é©Ÿé †åº** - ä¸è¦è·³æ­¥
2. **æ¯å€‹æ­¥é©Ÿéƒ½è¦é©—è­‰** - ä¸è¦å‡è¨­æˆåŠŸ
3. **é‡åˆ°éŒ¯èª¤ç«‹å³åœæ­¢** - å›å ±å•é¡Œï¼Œä¸è¦çŒœæ¸¬
4. **ä¿æŒ git commit é »ç¹** - æ¯å€‹å­ä»»å‹™ä¸€å€‹ commit
5. **æ¸¬è©¦å„ªå…ˆ** - é‡æ§‹å‰å…ˆç¢ºä¿æœ‰æ¸¬è©¦è¦†è“‹

### ä¸‹ä¸€æ­¥

å®Œæ•´çš„ REFACTORING_PLAN_V2.md å·²å‰µå»ºï¼ŒåŒ…å«ï¼š

- Phase 1: æ¶æ§‹åˆè¦æ€§ä¿®å¾©ï¼ˆè©³ç´°ï¼‰
- Phase 2: BLoC æ•ˆèƒ½å„ªåŒ–ï¼ˆå¾…è£œå……ï¼‰
- Phase 3: Use Case é‡æ§‹ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰
- Phase 4: æ¸¬è©¦è¦†è“‹ç‡ï¼ˆå¾…è£œå……ï¼‰

å»ºè­°æŒ‰é †åºåŸ·è¡Œ Phase 1 çš„æ‰€æœ‰ä»»å‹™ï¼Œç¢ºä¿æ¶æ§‹åŸºç¤ç©©å›ºå¾Œå†é€²è¡Œå¾ŒçºŒéšæ®µã€‚

---

**æ–‡ä»¶ç‰ˆæœ¬**: 2.0
**æœ€å¾Œæ›´æ–°**: 2026-01-14
**ç¶­è­·è€…**: Sonnet 4.5 (AI Code Analyst)
**å¯©æ ¸ç‹€æ…‹**: å·²æ•´åˆç”¨æˆ¶åé¥‹ï¼Œå¾…åŸ·è¡Œé©—è­‰
